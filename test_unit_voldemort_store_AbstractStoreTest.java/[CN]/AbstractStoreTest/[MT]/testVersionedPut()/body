{
  K key=getKey();
  Store<K,V> store=getStore();
  VectorClock clock=getClock(1,1);
  VectorClock clockCopy=clock.clone();
  V value=getValue();
  assertEquals("Store not empty at start!",0,store.get(key).size());
  Versioned<V> versioned=new Versioned<V>(value,clock);
  store.put(key,versioned);
  assertContains(store.get(key),versioned);
  testObsoletePutFails("Put of identical version/value succeeded.",store,key,new Versioned<V>(value,clockCopy));
  testObsoletePutFails("Put of identical version succeeded.",store,key,new Versioned<V>(getValue(),clockCopy));
  testObsoletePutFails("Put of obsolete version succeeded.",store,key,new Versioned<V>(getValue(),getClock(1)));
  assertEquals("Should still only be one version in store.",store.get(key).size(),1);
  assertContains(store.get(key),versioned);
  store.put(key,new Versioned<V>(getValue(),getClock(1,2)));
  if (!persistLatestValueOnly()) {
    assertEquals(2,store.get(key).size());
  }
 else {
    assertEquals(1,store.get(key).size());
  }
  Versioned<V> newest=new Versioned<V>(getValue(),getClock(1,1,2,2));
  store.put(key,newest);
  assertContains(store.get(key),newest);
}
