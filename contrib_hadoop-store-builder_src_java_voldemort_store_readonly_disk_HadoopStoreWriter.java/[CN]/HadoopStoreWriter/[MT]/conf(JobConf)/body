{
  this.conf=job;
  try {
    List<StoreDefinition> storeDefs=new StoreDefinitionsMapper().readStoreList(new StringReader(conf.get("stores.xml")));
    if (storeDefs.size() != 1)     throw new IllegalStateException("Expected to find only a single store, but found multiple!");
    this.storeDef=storeDefs.get(0);
    this.numChunks=conf.getInt(VoldemortBuildAndPushJob.NUM_CHUNKS,-1);
    if (this.numChunks < 1)     throw new VoldemortException(VoldemortBuildAndPushJob.NUM_CHUNKS + " not specified in the job conf.");
    this.saveKeys=conf.getBoolean(VoldemortBuildAndPushJob.SAVE_KEYS,false);
    this.position=new int[getNumChunks()];
    this.outputDir=job.get("final.output.dir");
    this.taskId=job.get("mapred.task.id");
    this.checkSumType=CheckSum.fromString(job.get("checksum.type"));
    this.checkSumDigestIndex=new CheckSum[getNumChunks()];
    this.checkSumDigestValue=new CheckSum[getNumChunks()];
    initFileStreams(conf.getBoolean(VoldemortBuildAndPushJob.REDUCER_OUTPUT_COMPRESS,false),conf.get(VoldemortBuildAndPushJob.REDUCER_OUTPUT_COMPRESS_CODEC,NO_COMPRESSION_CODEC));
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to open Input/OutputStream",e);
  }
}
