{
  File directory=new File(outputDir);
  if (directory.exists() || directory.mkdir()) {
    List<String> stores=storeNames;
    if (stores == null) {
      stores=Lists.newArrayList();
      List<StoreDefinition> storeDefinitionList=adminClient.getRemoteStoreDefList(nodeId).getValue();
      for (      StoreDefinition storeDefinition : storeDefinitionList) {
        stores.add(storeDefinition.getName());
      }
    }
    for (    String store : stores) {
      System.out.println("Fetching keys in partitions " + Joiner.on(", ").join(partitionIdList) + " of "+ store);
      File outputFile=new File(directory,store + ".keys");
      DataOutputStream dos=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(outputFile)));
      try {
        Iterator<ByteArray> keyIterator=adminClient.fetchKeys(nodeId,store,partitionIdList,null);
        while (keyIterator.hasNext()) {
          byte[] keyBytes=keyIterator.next().get();
          dos.writeInt(keyBytes.length);
          dos.write(keyBytes);
        }
      }
  finally {
        dos.close();
      }
      System.out.println("Fetched keys from " + store + " to "+ outputFile);
    }
  }
 else {
    Utils.croak("Can't find or create directory " + outputDir);
  }
}
