{
  VAdminProto.DeletePartitionEntriesResponse.Builder response=VAdminProto.DeletePartitionEntriesResponse.newBuilder();
  try {
    String storeName=request.getStore();
    List<Integer> partitions=request.getPartitionsList();
    StorageEngine<ByteArray,byte[]> storageEngine=storeRepository.getStorageEngine(storeName);
    if (storageEngine == null) {
      throw new VoldemortException("No store named '" + storeName + "'.");
    }
    RoutingStrategy routingStrategy=metadataStore.getRoutingStrategy(storageEngine.getName());
    VoldemortFilter filter=request.hasFilter() ? getFilterFromRequest(request.getFilter()) : new DefaultVoldemortFilter();
    EventThrottler throttler=new EventThrottler(streamMaxBytesReadPerSec);
    ClosableIterator<Pair<ByteArray,Versioned<byte[]>>> iterator=storageEngine.entries();
    int deleteSuccess=0;
    while (iterator.hasNext()) {
      Pair<ByteArray,Versioned<byte[]>> entry=iterator.next();
      if (validPartition(entry.getFirst().get(),partitions,routingStrategy) && filter.accept(entry.getFirst(),entry.getSecond())) {
        if (storageEngine.delete(entry.getFirst(),entry.getSecond().getVersion()))         deleteSuccess++;
        if (throttler != null)         throttler.maybeThrottle(entrySize(entry));
      }
    }
    iterator.close();
    response.setCount(deleteSuccess);
  }
 catch (  VoldemortException e) {
    response.setError(ProtoUtils.encodeError(errorCodeMapper,e));
  }
  return response.build();
}
