{
  Node node=this.getMetadata().getCluster().getNodeById(nodeId);
  SocketDestination destination=new SocketDestination(node.getHost(),node.getSocketPort(),RequestFormatType.ADMIN_PROTOCOL_BUFFERS);
  SocketAndStreams sands=pool.checkout(destination);
  try {
    Class cl=filter == null ? DefaultVoldemortFilter.class : filter.getClass();
    byte[] classBytes=networkClassLoader.dumpClass(cl);
    DataOutputStream outputStream=sands.getOutputStream();
    DataInputStream inputStream=sands.getInputStream();
    VAdminProto.VoldemortAdminRequest.Builder request=VAdminProto.VoldemortAdminRequest.newBuilder().setType(VAdminProto.AdminRequestType.DELETE_PARTITION_ENTRIES).setDeletePartitionEntries(VAdminProto.DeletePartitionEntriesRequest.newBuilder().addAllPartitions(partitionList).setFilter(VAdminProto.VoldemortFilter.newBuilder().setName(cl.getName()).setData(ProtoUtils.encodeBytes(new ByteArray(classBytes)))).setStore(storeName));
    ProtoUtils.writeMessage(outputStream,request.build());
    outputStream.flush();
    VAdminProto.DeletePartitionEntriesResponse.Builder response=ProtoUtils.readToBuilder(inputStream,VAdminProto.DeletePartitionEntriesResponse.newBuilder());
    if (response.hasError())     throwException(response.getError());
    return response.getCount();
  }
 catch (  IOException e) {
    close(sands.getSocket());
    throw new VoldemortException(e);
  }
 finally {
    pool.checkin(destination,sands);
  }
}
