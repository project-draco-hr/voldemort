{
  Map<Integer,List<Integer>> replicationMapping=new HashMap<Integer,List<Integer>>();
  List<Integer> targetList=targetCluster.getNodeById(stealNodeId).getPartitionIds();
  Multimap<Integer,Integer> replicationChanges=HashMultimap.create();
  for (  StoreDefinition storeDef : RebalanceUtils.getUniqueStoreDefinitions(this.oldStoreDefList)) {
    RebalanceClusterTool clusterTool=new RebalanceClusterTool(currentCluster,storeDef);
    Multimap<Integer,Integer> storeLevelReplicationChanges=clusterTool.getRemappedReplicas(targetCluster,RebalanceUtils.getStore(this.newStoreDefList,storeDef.getName()));
    replicationChanges.putAll(storeLevelReplicationChanges);
  }
  for (  final Entry<Integer,Integer> entry : replicationChanges.entries()) {
    int newReplicationPartition=entry.getValue();
    if (targetList.contains(newReplicationPartition)) {
      int donorNode=currentPartitionsToNodeMap.get(entry.getKey());
      if (donorNode != stealNodeId)       createAndAdd(replicationMapping,donorNode,entry.getKey());
    }
  }
  return replicationMapping;
}
