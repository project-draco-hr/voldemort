{
  try {
    if (!hasReadOnlyStores && !hasReadWriteStores) {
      throw new VoldemortException("Cannot get this state since it means there are no stores");
    }
 else     if (!hasReadOnlyStores && hasReadWriteStores && !finishedReadOnlyStores) {
      RebalanceUtils.printLog(taskId,logger,"Ignoring state change since there are no read-only stores");
    }
 else     if (!hasReadOnlyStores && hasReadWriteStores && finishedReadOnlyStores) {
      RebalanceUtils.printLog(taskId,logger,"Cluster metadata change + rebalance state change");
      if (!rebalanceConfig.isShowPlanEnabled())       adminClient.rebalanceStateChange(currentCluster,transitionCluster,rebalancePartitionPlanList,false,true,true,true,true);
    }
 else     if (hasReadOnlyStores && !finishedReadOnlyStores) {
      RebalanceUtils.printLog(taskId,logger,"Rebalance state change");
      if (!rebalanceConfig.isShowPlanEnabled())       adminClient.rebalanceStateChange(currentCluster,transitionCluster,rebalancePartitionPlanList,false,false,true,true,true);
    }
 else     if (hasReadOnlyStores && !hasReadWriteStores && finishedReadOnlyStores) {
      RebalanceUtils.printLog(taskId,logger,"Swap + Cluster metadata change");
      if (!rebalanceConfig.isShowPlanEnabled())       adminClient.rebalanceStateChange(currentCluster,transitionCluster,rebalancePartitionPlanList,true,true,false,true,true);
    }
 else {
      RebalanceUtils.printLog(taskId,logger,"Swap + Cluster metadata change + rebalance state change");
      if (!rebalanceConfig.isShowPlanEnabled())       adminClient.rebalanceStateChange(currentCluster,transitionCluster,rebalancePartitionPlanList,true,true,true,true,true);
    }
  }
 catch (  VoldemortRebalancingException e) {
    RebalanceUtils.printErrorLog(taskId,logger,"Failure while changing rebalancing state",e);
    throw e;
  }
}
