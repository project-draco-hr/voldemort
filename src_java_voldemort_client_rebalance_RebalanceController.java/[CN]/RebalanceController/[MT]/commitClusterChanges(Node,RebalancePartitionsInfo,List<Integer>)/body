{
synchronized (adminClient) {
    Cluster currentCluster=adminClient.getAdminClientCluster();
    Node donorNode=currentCluster.getNodeById(rebalanceStealInfo.getDonorId());
    List<Integer> checkNodeIds=Lists.newArrayList();
    checkNodeIds.addAll(concurrentDonors);
    checkNodeIds.add(rebalanceStealInfo.getStealerId());
    VectorClock latestClock=(VectorClock)RebalanceUtils.getLatestCluster(checkNodeIds,adminClient).getVersion();
    Cluster updatedCluster=RebalanceUtils.createUpdatedCluster(currentCluster,stealerNode,donorNode,rebalanceStealInfo.getStealMasterPartitions());
    latestClock.incrementVersion(stealerNode.getId(),System.currentTimeMillis());
    try {
      RebalanceUtils.propagateCluster(adminClient,updatedCluster,latestClock,Arrays.asList(stealerNode.getId(),rebalanceStealInfo.getDonorId()));
      adminClient.setAdminClientCluster(updatedCluster);
    }
 catch (    Exception e) {
      updatedCluster=currentCluster;
      latestClock.incrementVersion(stealerNode.getId(),System.currentTimeMillis());
      RebalanceUtils.propagateCluster(adminClient,updatedCluster,latestClock,new ArrayList<Integer>());
      throw e;
    }
    adminClient.setAdminClientCluster(updatedCluster);
  }
}
