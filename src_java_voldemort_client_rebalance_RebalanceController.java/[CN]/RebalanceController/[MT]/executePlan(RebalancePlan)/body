{
  logger.info("Starting rebalancing!");
  int batchCount=0;
  int partitionStoreCount=0;
  long totalTimeMs=0;
  List<RebalanceClusterPlan> entirePlan=rebalancePlan.getPlan();
  int numBatches=entirePlan.size();
  int numPartitionStores=rebalancePlan.getPartitionStoresMoved();
  for (  RebalanceClusterPlan batchPlan : entirePlan) {
    logger.info("========  REBALANCING BATCH " + (batchCount + 1) + "  ========");
    RebalanceTypedBatchPlan executableBatch=null;
    if (stealerBasedRebalancing) {
      executableBatch=new RebalanceStealerBasedBatchPlan(batchPlan);
    }
 else {
      executableBatch=new RebalanceDonorBasedBatchPlan(batchPlan);
    }
    final OrderedClusterTransition orderedClusterTransition=new OrderedClusterTransition(executableBatch);
    RebalanceUtils.printLog(batchCount,logger,orderedClusterTransition.toString());
    long startTimeMs=System.currentTimeMillis();
    executeBatch(batchCount,batchPlan.getCurrentCluster(),batchPlan.getFinalCluster(),batchPlan.getStoreDefs(),orderedClusterTransition);
    totalTimeMs+=(System.currentTimeMillis() - startTimeMs);
    batchCount++;
    partitionStoreCount+=batchPlan.getPartitionStoreMoves();
    batchStatusLog(batchCount,numBatches,partitionStoreCount,numPartitionStores,totalTimeMs);
  }
}
