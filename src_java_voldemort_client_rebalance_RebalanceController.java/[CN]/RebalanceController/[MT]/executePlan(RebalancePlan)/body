{
  logger.info("Starting rebalancing!");
  int batchCount=0;
  int partitionStoreCount=0;
  long totalTimeMs=0;
  List<RebalanceClusterPlan> plan=rebalancePlan.getPlan();
  int numBatches=plan.size();
  int numPartitionStores=rebalancePlan.getPartitionStoresMoved();
  for (  RebalanceClusterPlan batch : plan) {
    logger.info("========  REBALANCING BATCH " + (batchCount + 1) + "  ========");
    RebalanceTypedBatchPlan executableBatch=null;
    if (stealerBasedRebalancing) {
      executableBatch=new RebalanceStealerBasedBatchPlan(batch);
    }
 else {
      executableBatch=new RebalanceDonorBasedBatchPlan(batch);
    }
    final OrderedClusterTransition orderedClusterTransition=new OrderedClusterTransition(executableBatch);
    RebalanceUtils.printLog(orderedClusterTransition.getId(),logger,orderedClusterTransition.toString());
    long startTimeMs=System.currentTimeMillis();
    executeBatch(orderedClusterTransition);
    totalTimeMs+=(System.currentTimeMillis() - startTimeMs);
    batchCount++;
    partitionStoreCount+=batch.getPartitionStoreMoves();
    batchStatusLog(orderedClusterTransition.getId(),batchCount,numBatches,partitionStoreCount,numPartitionStores,totalTimeMs);
  }
}
