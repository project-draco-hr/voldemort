{
  if (null == dataFile && null == indexFile) {
    String fileName=currentPair.getSecond().toString() + "_" + currentPair.getFirst().toString()+ "_"+ Integer.toString(currentChunkId);
    dataFile=new File(this.storeDir,fileName + ".data");
    indexFile=new File(this.storeDir,fileName + ".index");
    validateFiles();
    if (isPartitionFinished()) {
      fetchStatus=FetchStatus.next_partition;
      return;
    }
    this.chunkedFileWriter=new ChunkedFileWriter(dataFile,outputStream);
    logger.info("Streaming " + dataFile.getAbsolutePath());
    this.chunkedFileWriter.writeHeader();
  }
  if (0 == chunkedFileWriter.streamFile()) {
    logger.info("Completed streaming " + dataFile.getAbsolutePath());
    this.chunkedFileWriter.close();
    this.chunkedFileWriter=new ChunkedFileWriter(indexFile,outputStream);
    logger.info("Streaming " + indexFile.getAbsolutePath());
    this.chunkedFileWriter.writeHeader();
    fetchStatus=FetchStatus.send_index_file;
  }
 else {
    fetchStatus=FetchStatus.send_data_file;
  }
}
