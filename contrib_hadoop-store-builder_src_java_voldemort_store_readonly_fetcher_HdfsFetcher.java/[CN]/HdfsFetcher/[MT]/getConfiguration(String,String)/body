{
  final Configuration config=new Configuration();
  config.setInt(ConfigurableSocketFactory.SO_RCVBUF,bufferSize);
  config.setInt(ConfigurableSocketFactory.SO_TIMEOUT,socketTimeout);
  config.set("hadoop.rpc.socket.factory.class.ClientProtocol",ConfigurableSocketFactory.class.getName());
  config.set("hadoop.security.group.mapping","org.apache.hadoop.security.ShellBasedUnixGroupsMapping");
  boolean isHftpBasedFetch=isHftpBasedPath(sourceFileUrl);
  logger.info("URL : " + sourceFileUrl + " and hftp protocol enabled = "+ isHftpBasedFetch);
  logger.info("Hadoop path = " + hadoopConfigPath + " , keytab path = "+ HdfsFetcher.keytabPath+ " , kerberos principal = "+ HdfsFetcher.kerberosPrincipal);
  if (hadoopConfigPath.length() > 0) {
    config.addResource(new Path(hadoopConfigPath + "/core-site.xml"));
    config.addResource(new Path(hadoopConfigPath + "/hdfs-site.xml"));
    String security=config.get(CommonConfigurationKeys.HADOOP_SECURITY_AUTHENTICATION);
    if (security == null) {
      throw new VoldemortException(CommonConfigurationKeys.HADOOP_SECURITY_AUTHENTICATION + " is undefined in the config. It must be set to either 'kerberos' or 'simple'.");
    }
 else     if (security.equals("simple")) {
      logger.info("Security is explicitly disabled in the conf.");
    }
 else     if (!security.equals("kerberos")) {
      throw new VoldemortException("Error in getting a valid Hadoop Configuration. " + "Make sure the Hadoop config directory path is correct via" + VoldemortConfig.HADOOP_CONFIG_PATH + " and that "+ CommonConfigurationKeys.HADOOP_SECURITY_AUTHENTICATION+ " is set to either 'kerberos' or 'simple'.");
    }
 else {
      logger.info("Security is turned on in the conf.");
    }
  }
  return config;
}
