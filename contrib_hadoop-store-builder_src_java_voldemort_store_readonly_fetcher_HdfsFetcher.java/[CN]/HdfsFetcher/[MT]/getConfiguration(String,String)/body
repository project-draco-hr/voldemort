{
  final Configuration config=new Configuration();
  config.setInt(ConfigurableSocketFactory.SO_RCVBUF,bufferSize);
  config.setInt(ConfigurableSocketFactory.SO_TIMEOUT,socketTimeout);
  config.set("hadoop.rpc.socket.factory.class.ClientProtocol",ConfigurableSocketFactory.class.getName());
  config.set("hadoop.security.group.mapping","org.apache.hadoop.security.ShellBasedUnixGroupsMapping");
  boolean isHftpBasedFetch=isHftpBasedPath(sourceFileUrl);
  logger.info("URL : " + sourceFileUrl + " and hftp protocol enabled = "+ isHftpBasedFetch);
  logger.info("Hadoop path = " + hadoopConfigPath + " , keytab path = "+ HdfsFetcher.keytabPath+ " , kerberos principal = "+ HdfsFetcher.kerberosPrincipal);
  if (hadoopConfigPath.length() > 0) {
    config.addResource(new Path(hadoopConfigPath + "/core-site.xml"));
    config.addResource(new Path(hadoopConfigPath + "/hdfs-site.xml"));
    String security=config.get(CommonConfigurationKeys.HADOOP_SECURITY_AUTHENTICATION);
    if (security != null && security.equals("kerberos")) {
      logger.info("Kerberos authentication is turned on in the Hadoop conf.");
    }
 else     if (security != null && security.equals("simple")) {
      logger.info("Authentication is explicitly disabled in the Hadoop conf.");
    }
 else {
      throw new VoldemortException("Error in getting a valid Hadoop Configuration. " + "Make sure the Hadoop config directory path is correct via" + VoldemortConfig.HADOOP_CONFIG_PATH + " and that the "+ CommonConfigurationKeys.HADOOP_SECURITY_AUTHENTICATION+ " property in the Hadoop config is set to either 'kerberos' or 'simple'. "+ "That property is currently set to '"+ security+ "'.");
    }
  }
  return config;
}
