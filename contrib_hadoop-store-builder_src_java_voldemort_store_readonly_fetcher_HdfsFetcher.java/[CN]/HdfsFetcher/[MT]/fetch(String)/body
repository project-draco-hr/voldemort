{
  Path path=new Path(fileUrl);
  Configuration config=new Configuration();
  config.setInt("io.socket.receive.buffer",bufferSize);
  config.set("hadoop.rpc.socket.factory.class.ClientProtocol",ConfigurableSocketFactory.class.getName());
  FileSystem fs=path.getFileSystem(config);
  EventThrottler throttler=null;
  if (maxBytesPerSecond != null)   throttler=new EventThrottler(maxBytesPerSecond);
  CopyStats stats=new CopyStats(fileUrl);
  ObjectName jmxName=JmxUtils.registerMbean("hdfs-copy-" + copyCount.getAndIncrement(),stats);
  try {
    File destination=new File(this.tempDir,path.getName());
    fetch(fs,path,destination,throttler,stats);
    return destination;
  }
  finally {
    JmxUtils.unregisterMbean(jmxName);
  }
}
