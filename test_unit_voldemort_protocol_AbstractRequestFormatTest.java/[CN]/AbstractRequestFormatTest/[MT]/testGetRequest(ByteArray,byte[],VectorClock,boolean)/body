{
  try {
    if (isPresent)     store.put(key,Versioned.value(value,version));
    ByteArrayOutputStream getRequest=new ByteArrayOutputStream();
    this.clientWireFormat.writeGetRequest(new DataOutputStream(getRequest),storeName,key,RequestRoutingType.NORMAL);
    ByteArrayOutputStream getResponse=new ByteArrayOutputStream();
    this.serverWireFormat.handleRequest(inputStream(getRequest),new DataOutputStream(getResponse));
    List<Versioned<byte[]>> values=this.clientWireFormat.readGetResponse(inputStream(getResponse));
    if (isPresent) {
      assertEquals(1,values.size());
      Versioned<byte[]> v=values.get(0);
      assertEquals(version,v.getVersion());
      assertTrue(Arrays.equals(v.getValue(),value));
    }
 else {
      assertEquals(0,values.size());
    }
  }
  finally {
    this.store.deleteAll();
  }
}
