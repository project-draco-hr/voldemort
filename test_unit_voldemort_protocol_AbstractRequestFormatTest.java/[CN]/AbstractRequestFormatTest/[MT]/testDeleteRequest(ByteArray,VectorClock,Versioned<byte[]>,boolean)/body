{
  try {
    if (existingValue != null) {
      testPutRequest(key,existingValue.getValue(),null,(VectorClock)existingValue.getVersion(),null,false);
    }
    ByteArrayOutputStream delRequest=new ByteArrayOutputStream();
    this.clientWireFormat.writeDeleteRequest(new DataOutputStream(delRequest),storeName,key,version,RequestRoutingType.NORMAL);
    testIsCompleteRequest(delRequest);
    ByteArrayOutputStream delResponse=handleRequest(delRequest);
    boolean wasDeleted=this.clientWireFormat.readDeleteResponse(inputStream(delResponse));
    assertEquals(isDeleted,wasDeleted);
  }
  finally {
    this.store.deleteAll();
  }
}
