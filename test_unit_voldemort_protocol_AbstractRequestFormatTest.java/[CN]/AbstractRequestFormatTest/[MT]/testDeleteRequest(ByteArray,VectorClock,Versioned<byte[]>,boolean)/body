{
  try {
    if (existingValue != null)     this.store.put(key,existingValue);
    ByteArrayOutputStream delRequest=new ByteArrayOutputStream();
    this.clientWireFormat.writeDeleteRequest(new DataOutputStream(delRequest),storeName,key,version,false);
    ByteArrayOutputStream delResponse=new ByteArrayOutputStream();
    this.serverWireFormat.handleRequest(inputStream(delRequest),new DataOutputStream(delResponse));
    boolean wasDeleted=this.clientWireFormat.readDeleteResponse(inputStream(delResponse));
    assertEquals(isDeleted,wasDeleted);
  }
  finally {
    this.store.deleteAll();
  }
}
