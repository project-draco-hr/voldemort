{
  RoutingStrategy routingStrategy=new RoutingStrategyFactory().updateRoutingStrategy(storeDefinition,newCluster);
  ImmutableMultimap.Builder<Integer,Integer> builder=ImmutableSetMultimap.builder();
  for (int i=0; i < newCluster.getNumberOfPartitions(); i++) {
    builder.putAll(i,routingStrategy.getReplicatingPartitionList(i));
  }
  Multimap<Integer,Integer> newMasterToReplicas=builder.build();
  int missingReplicas=0;
  for (  Map.Entry<Integer,Integer> entry : masterToReplicas.entries()) {
    int master=entry.getKey();
    int replica=entry.getValue();
    if (!newMasterToReplicas.get(master).contains(replica))     missingReplicas++;
  }
  return missingReplicas;
}
