{
  cluster=ServerTestUtils.getLocalCluster(2,new int[][]{{0,1,2,3},{4,5,6,7}});
  servers=new VoldemortServer[2];
  servers[0]=ServerTestUtils.startVoldemortServer(socketStoreFactory,ServerTestUtils.createServerConfig(true,0,TestUtils.createTempDir().getAbsolutePath(),null,storesXmlfile,new Properties()),cluster);
  servers[1]=ServerTestUtils.startVoldemortServer(socketStoreFactory,ServerTestUtils.createServerConfig(true,1,TestUtils.createTempDir().getAbsolutePath(),null,storesXmlfile,new Properties()),cluster);
  socketUrl=servers[0].getIdentityNode().getSocketUrl().toString();
  ClientConfig clientConfig=new ClientConfig().setMaxTotalConnections(4).setMaxConnectionsPerNode(4).setBootstrapUrls(socketUrl);
  SocketStoreClientFactory socketFactory=new SocketStoreClientFactory(clientConfig);
  bootStrapUrls=new String[1];
  bootStrapUrls[0]=socketUrl;
  clusterXml=((AbstractStoreClientFactory)socketFactory).bootstrapMetadataWithRetries(MetadataStore.CLUSTER_KEY);
}
