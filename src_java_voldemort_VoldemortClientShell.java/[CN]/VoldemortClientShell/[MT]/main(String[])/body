{
  if (args.length < 2 || args.length > 3)   Utils.croak("USAGE: java VoldemortClientShell store_name bootstrap_url [command_file]");
  String storeName=args[0];
  String bootstrapUrl=args[1];
  BufferedReader reader=null;
  try {
    if (args.length == 3)     reader=new BufferedReader(new FileReader(args[2]));
 else     reader=new BufferedReader(new InputStreamReader(System.in));
  }
 catch (  IOException e) {
    Utils.croak("Failure to open input stream: " + e.getMessage());
  }
  ClientConfig clientConfig=new ClientConfig().setBootstrapUrls(bootstrapUrl);
  StoreClientFactory factory=new SocketStoreClientFactory(clientConfig);
  DefaultStoreClient<Object,Object> client=null;
  try {
    client=(DefaultStoreClient<Object,Object>)factory.getStoreClient(storeName);
  }
 catch (  Exception e) {
    Utils.croak("Could not connect to server: " + e.getMessage());
  }
  System.out.println("Established connection to " + storeName + " via "+ bootstrapUrl);
  System.out.print(PROMPT);
  for (String line=reader.readLine(); line != null; line=reader.readLine()) {
    if (line.trim().equals(""))     continue;
    try {
      if (line.toLowerCase().startsWith("put")) {
        JsonReader jsonReader=new JsonReader(new StringReader(line.substring("put".length())));
        client.put(tightenNumericTypes(jsonReader.read()),tightenNumericTypes(jsonReader.read()));
      }
 else       if (line.toLowerCase().startsWith("getall")) {
        JsonReader jsonReader=new JsonReader(new StringReader(line.substring("getall".length())));
        List<Object> keys=new ArrayList<Object>();
        try {
          while (true)           keys.add(jsonReader.read());
        }
 catch (        EndOfFileException e) {
        }
        Map<Object,Versioned<Object>> vals=client.getAll(keys);
        for (        Map.Entry<Object,Versioned<Object>> entry : vals.entrySet()) {
          System.out.print(entry.getKey());
          System.out.print(" => ");
          printVersioned(entry.getValue());
        }
      }
 else       if (line.toLowerCase().startsWith("get")) {
        JsonReader jsonReader=new JsonReader(new StringReader(line.substring("get".length())));
        printVersioned(client.get(tightenNumericTypes(jsonReader.read())));
      }
 else       if (line.toLowerCase().startsWith("delete")) {
        JsonReader jsonReader=new JsonReader(new StringReader(line.substring("delete".length())));
        client.delete(tightenNumericTypes(jsonReader.read()));
      }
 else       if (line.startsWith("locate")) {
        JsonReader jsonReader=new JsonReader(new StringReader(line.substring("locate".length())));
        Object key=tightenNumericTypes(jsonReader.read());
        printNodeList(client.getResponsibleNodes(key),factory.getNodeAvailabilityDetector());
      }
 else       if (line.startsWith("help")) {
        System.out.println("Commands:");
        System.out.println("put key value -- Associate the given value with the key.");
        System.out.println("get key -- Retrieve the value associated with the key.");
        System.out.println("delete key -- Remove all values associated with the key.");
        System.out.println("locate key -- Determine which servers host the give key.");
        System.out.println("help -- Print this message.");
        System.out.println("exit -- Exit from this shell.");
        System.out.println();
      }
 else       if (line.startsWith("quit") || line.startsWith("exit")) {
        System.out.println("k k thx bye.");
        System.exit(0);
      }
 else {
        System.err.println("Invalid command.");
      }
    }
 catch (    EndOfFileException e) {
      System.err.println("Expected additional token.");
    }
catch (    SerializationException e) {
      System.err.print("Error serializing values: ");
      e.printStackTrace();
    }
catch (    VoldemortException e) {
      System.err.println("Exception thrown during operation.");
      e.printStackTrace(System.err);
    }
catch (    ArrayIndexOutOfBoundsException e) {
      System.err.println("Invalid command.");
    }
catch (    Exception e) {
      System.err.println("Unexpected error:");
      e.printStackTrace(System.err);
    }
    System.out.print(PROMPT);
  }
}
