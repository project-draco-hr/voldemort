{
  OptionParser parser=new OptionParser();
  parser.accepts("client-zone-id","client zone id for zone routing").withRequiredArg().describedAs("zone-id").ofType(Integer.class);
  OptionSet options=parser.parse(args);
  List<String> nonOptions=options.nonOptionArguments();
  if (nonOptions.size() < 2 || nonOptions.size() > 3) {
    System.err.println("Usage: java VoldemortClientShell store_name bootstrap_url [command_file] [options]");
    parser.printHelpOn(System.err);
    System.exit(-1);
  }
  String storeName=nonOptions.get(0);
  String bootstrapUrl=nonOptions.get(1);
  String commandsFileName="";
  BufferedReader fileReader=null;
  BufferedReader inputReader=null;
  try {
    if (nonOptions.size() == 3) {
      commandsFileName=nonOptions.get(2);
      fileReader=new BufferedReader(new FileReader(commandsFileName));
    }
    inputReader=new BufferedReader(new InputStreamReader(System.in));
  }
 catch (  IOException e) {
    Utils.croak("Failure to open input stream: " + e.getMessage());
  }
  ClientConfig clientConfig=new ClientConfig().setBootstrapUrls(bootstrapUrl).setEnableLazy(false).setRequestFormatType(RequestFormatType.VOLDEMORT_V3);
  if (options.has("client-zone-id")) {
    clientConfig.setClientZoneId((Integer)options.valueOf("client-zone-id"));
  }
  StoreClientFactory factory=null;
  AdminClient adminClient=null;
  try {
    try {
      factory=new SocketStoreClientFactory(clientConfig);
      client=(DefaultStoreClient<Object,Object>)factory.getStoreClient(storeName);
      adminClient=new AdminClient(bootstrapUrl,new AdminClientConfig());
    }
 catch (    Exception e) {
      Utils.croak("Could not connect to server: " + e.getMessage());
    }
    System.out.println("Established connection to " + storeName + " via "+ bootstrapUrl);
    System.out.print(PROMPT);
    if (fileReader != null) {
      processCommands(factory,adminClient,fileReader,true);
      fileReader.close();
    }
    processCommands(factory,adminClient,inputReader,false);
  }
  finally {
    if (adminClient != null)     adminClient.stop();
    if (factory != null)     factory.close();
  }
}
