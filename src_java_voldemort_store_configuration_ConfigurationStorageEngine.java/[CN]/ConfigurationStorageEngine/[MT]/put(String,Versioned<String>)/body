{
  StoreUtils.assertValidKey(key);
  if (null == value.getValue()) {
    throw new VoldemortException("metadata cannot be null !!");
  }
  File[] files=getDirectory(key).listFiles();
  for (  File file : files) {
    if (file.getName().equals(key)) {
      VectorClock clock=readVersion(key);
      if (value.getVersion().compare(clock) == Occured.AFTER) {
      }
 else       if (value.getVersion().compare(clock) == Occured.BEFORE) {
        throw new ObsoleteVersionException("A successor version to this exists.");
      }
 else       if (value.getVersion().compare(clock) == Occured.CONCURRENTLY) {
        throw new ObsoleteVersionException("Concurrent Operation not allowed on Metadata.");
      }
    }
  }
  File keyFile=new File(getDirectory(key),key);
  VectorClock newClock=(VectorClock)value.getVersion();
  if (!keyFile.exists() || keyFile.delete()) {
    try {
      FileUtils.writeStringToFile(keyFile,value.getValue(),"UTF-8");
      writeVersion(key,newClock);
    }
 catch (    IOException e) {
      throw new VoldemortException(e);
    }
  }
}
