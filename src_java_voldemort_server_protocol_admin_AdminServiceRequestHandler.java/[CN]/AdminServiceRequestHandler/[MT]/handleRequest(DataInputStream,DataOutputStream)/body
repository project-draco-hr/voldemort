{
  byte opCode=inputStream.readByte();
  StorageEngine<ByteArray,byte[]> engine;
switch (opCode) {
case VoldemortOpCode.GET_PARTITION_AS_STREAM_OP_CODE:
    engine=readStorageEngine(inputStream,outputStream);
  if (engine != null)   handleGetPartitionsAsStream(engine,inputStream,outputStream);
break;
case VoldemortOpCode.PUT_ENTRIES_AS_STREAM_OP_CODE:
engine=readStorageEngine(inputStream,outputStream);
if (engine != null) handleUpdateEntriesAsStream(engine,inputStream,outputStream);
break;
case VoldemortOpCode.DELETE_PARTITIONS_OP_CODE:
engine=readStorageEngine(inputStream,outputStream);
if (engine != null) handleDeletePartitions(engine,inputStream,outputStream);
break;
case VoldemortOpCode.UPDATE_METADATA_OP_CODE:
byte[] key=readKey(inputStream);
handleUpdateMetadataRequest(new ByteArray(key),inputStream,outputStream);
break;
case VoldemortOpCode.GET_METADATA_OP_CODE:
key=readKey(inputStream);
handleGetMetadataRequest(new ByteArray(key),inputStream,outputStream);
break;
case VoldemortOpCode.REDIRECT_GET_OP_CODE:
engine=readStorageEngine(inputStream,outputStream);
key=readKey(inputStream);
handleRedirectGetRequest(engine,key,outputStream);
break;
default :
throw new IOException("Unknown op code : " + opCode + " at Node:"+ metadataStore.getNodeId());
}
outputStream.flush();
}
