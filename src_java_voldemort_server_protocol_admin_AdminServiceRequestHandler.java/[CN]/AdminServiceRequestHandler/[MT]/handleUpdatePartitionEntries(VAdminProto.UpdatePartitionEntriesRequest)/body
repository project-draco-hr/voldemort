{
  StorageEngine<ByteArray,byte[],byte[]> storageEngine=AdminServiceRequestHandler.getStorageEngine(storeRepository,request.getStore());
  if (request.hasOverwriteIfLatest() && request.getOverwriteIfLatest()) {
    return new TimeBasedUpdatePartitionEntriesStreamRequestHandler(request,errorCodeMapper,voldemortConfig,storageEngine,storeRepository,networkClassLoader);
  }
 else {
    if (doesStorageEngineSupportMultiVersionPuts(storageEngine)) {
      return new BufferedUpdatePartitionEntriesStreamRequestHandler(request,errorCodeMapper,voldemortConfig,storageEngine,storeRepository,networkClassLoader);
    }
 else {
      return new UpdatePartitionEntriesStreamRequestHandler(request,errorCodeMapper,voldemortConfig,storageEngine,storeRepository,networkClassLoader);
    }
  }
}
