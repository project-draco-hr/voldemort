{
  final String storeName=request.getStoreName();
  VAdminProto.RollbackStoreResponse.Builder response=VAdminProto.RollbackStoreResponse.newBuilder();
  try {
    ReadOnlyStorageEngine store=(ReadOnlyStorageEngine)getStorageEngine(storeRepository,storeName);
    long pushVersion;
    if (request.hasPushVersion()) {
      pushVersion=request.getPushVersion();
    }
 else {
      pushVersion=store.getMaxVersionId();
    }
    File rollbackVersionDir=new File(store.getStoreDirPath(),"version-" + pushVersion);
    if (!rollbackVersionDir.exists())     throw new VoldemortException("Rollback failed since version of push specified (" + pushVersion + ") does not exist. ");
    store.rollback(rollbackVersionDir);
  }
 catch (  VoldemortException e) {
    response.setError(ProtoUtils.encodeError(errorCodeMapper,e));
    logger.error("handleRollbackStore failed for request(" + request.toString() + ")",e);
  }
  return response.build();
}
