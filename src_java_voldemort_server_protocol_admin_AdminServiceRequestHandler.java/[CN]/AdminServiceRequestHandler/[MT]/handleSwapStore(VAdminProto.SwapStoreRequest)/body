{
  final String dir=request.getStoreDir();
  final String storeName=request.getStoreName();
  VAdminProto.SwapStoreResponse.Builder response=VAdminProto.SwapStoreResponse.newBuilder();
  if (metadataStore.getServerState().equals(MetadataStore.VoldemortState.REBALANCING_MASTER_SERVER)) {
    response.setError(ProtoUtils.encodeError(errorCodeMapper,new VoldemortException("Rebalancing in progress")));
    return response.build();
  }
  try {
    ReadOnlyStorageEngine store=(ReadOnlyStorageEngine)getStorageEngine(storeRepository,storeName);
    if (!Utils.isReadableDir(dir))     throw new VoldemortException("Store directory '" + dir + "' is not a readable directory.");
    store.swapFiles(dir);
  }
 catch (  VoldemortException e) {
    response.setError(ProtoUtils.encodeError(errorCodeMapper,e));
    logger.error("handleSwapStore failed for request(" + request.toString() + ")",e);
  }
  return response.build();
}
