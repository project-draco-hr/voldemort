{
  VAdminProto.UpdateMetadataResponse.Builder response=VAdminProto.UpdateMetadataResponse.newBuilder();
  metadataStore.writeLock.lock();
  try {
    for (    KeyedVersions keyValue : request.getMetadataEntryList()) {
      try {
        ByteArray key=ProtoUtils.decodeBytes(keyValue.getKey());
        String keyString=ByteUtils.getString(key.get(),"UTF-8");
        if (MetadataStore.METADATA_KEYS.contains(keyString)) {
          Versioned<byte[]> versionedValue=ProtoUtils.decodeVersionedMetadataKeyValue(keyValue);
          logger.info("Updating metadata for key '" + keyString + "'");
          metadataStore.put(new ByteArray(ByteUtils.getBytes(keyString,"UTF-8")),versionedValue,null);
          logger.info("Successfully updated metadata for key '" + keyString + "'");
        }
      }
 catch (      VoldemortException e) {
        response.setError(ProtoUtils.encodeError(errorCodeMapper,e));
        logger.error("handleUpdateMetadata failed for request(" + request.toString() + ")",e);
      }
    }
    return response.build();
  }
  finally {
    metadataStore.writeLock.unlock();
  }
}
