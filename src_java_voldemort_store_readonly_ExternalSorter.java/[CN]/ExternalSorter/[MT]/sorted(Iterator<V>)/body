{
  List<File> tempFiles=new ArrayList<File>();
  List<V> buffer=new ArrayList<V>(internalSortSize);
  while (input.hasNext()) {
    for (int i=0; i < internalSortSize && input.hasNext(); i++)     buffer.add(input.next());
    Collections.sort(buffer,comparator);
    try {
      File tempFile=File.createTempFile("chunk-",".dat",tempDir);
      tempFile.deleteOnExit();
      tempFiles.add(tempFile);
      DataOutputStream output=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(tempFile),bufferSize));
      for (      V v : buffer)       writeValue(output,v);
      output.close();
      buffer.clear();
    }
 catch (    IOException e) {
      throw new VoldemortException(e);
    }
  }
  return new DefaultIterable<V>(new ExternalSorterIterator(tempFiles,bufferSize / tempFiles.size()));
}
