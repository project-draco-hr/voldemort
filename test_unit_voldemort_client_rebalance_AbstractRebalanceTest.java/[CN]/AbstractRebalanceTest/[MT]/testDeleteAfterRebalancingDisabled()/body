{
  Cluster currentCluster=ServerTestUtils.getLocalCluster(2,new int[][]{{0,1,2,3,4,5,6,7,8},{}});
  Cluster targetCluster=ServerTestUtils.getLocalCluster(2,new int[][]{{0,1,4,5,6,7,8},{2,3}});
  List<Integer> serverList=Arrays.asList(0,1);
  Cluster updatedCluster=startServers(currentCluster,storeDefFile,serverList,null);
  targetCluster=updateCluster(targetCluster);
  RebalanceController rebalanceClient=new RebalanceController(getBootstrapUrl(updatedCluster,0),new RebalanceClientConfig());
  try {
    populateData(updatedCluster,Arrays.asList(0));
    rebalanceAndCheck(updatedCluster,targetCluster,rebalanceClient,Arrays.asList(1));
    rebalanceClient.getAdminClient().updateRemoteCluster(0,updatedCluster,((VectorClock)RebalanceUtils.getLatestCluster(null,rebalanceClient.getAdminClient()).getVersion()).incremented(0,System.currentTimeMillis()));
    checkGetEntries(updatedCluster.getNodeById(0),updatedCluster,null,Arrays.asList(2,3));
  }
  finally {
    stopServer(serverList);
  }
}
