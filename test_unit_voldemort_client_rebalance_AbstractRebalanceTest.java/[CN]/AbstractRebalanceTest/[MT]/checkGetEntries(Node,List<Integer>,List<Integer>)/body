{
  RoutingStrategy routing=new ConsistentRoutingStrategy(targetCluster.getNodes(),1);
  SocketStore store=ServerTestUtils.getSocketStore(testStoreName,node.getHost(),node.getSocketPort(),RequestFormatType.PROTOCOL_BUFFERS);
  for (  Entry<ByteArray,byte[]> entry : testEntries.entrySet()) {
    List<Integer> partitions=routing.getPartitionList(entry.getKey().get());
    if (unavailablePartitions.containsAll(partitions)) {
      try {
        List<Versioned<byte[]>> value=store.get(entry.getKey());
        fail();
      }
 catch (      InvalidMetadataException e) {
      }
    }
 else     if (availablePartitions.containsAll(partitions)) {
      List<Versioned<byte[]>> values=store.get(entry.getKey());
      assertEquals("Expecting exactly one version",1,values.size());
      Versioned<byte[]> value=values.get(0);
      assertEquals("Value version should match",new VectorClock(),value.getVersion());
      assertEquals("Value bytes should match",0,ByteUtils.compare(entry.getValue(),value.getValue()));
    }
  }
}
