{
  Cluster currentCluster=ServerTestUtils.getLocalCluster(3,new int[][]{{0,1,2,3,4,5,6,7,8},{},{}});
  Cluster targetCluster=ServerTestUtils.getLocalCluster(3,new int[][]{{0,1,4,5,6},{2,3},{7,8}});
  List<Integer> serverList=Arrays.asList(0,1,2);
  Cluster updatedCluster=startServers(currentCluster,storeDefFile,serverList);
  try {
    populateData(updatedCluster,Arrays.asList(0));
    RebalanceClientConfig config=new RebalanceClientConfig();
    config.setMaxParallelRebalancing(2);
    RebalanceClient rebalanceClient=new RebalanceClient(getBootstrapUrl(currentCluster,0),config);
    rebalanceClient.rebalance(targetCluster,Arrays.asList(testStoreName));
    checkGetEntries(updatedCluster.getNodeById(1),targetCluster,Arrays.asList(0,1,4,5,6,7,8),Arrays.asList(2,3));
    checkGetEntries(updatedCluster.getNodeById(2),targetCluster,Arrays.asList(0,1,2,3,4,5,6),Arrays.asList(7,8));
  }
  finally {
    stopServer(serverList);
  }
}
