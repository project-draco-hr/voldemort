{
  System.out.println("testClusterTransitionDeletingLastNode() running...");
  currentCluster=ServerTestUtils.getLocalCluster(4,new int[][]{{0,4},{1,5},{2,6},{3,7}});
  targetCluster=ServerTestUtils.getLocalCluster(4,new int[][]{{3,0,4},{1,5},{2,6},{7}});
  OrderedClusterTransition orderedClusterTransition=createOrderedClusterTransition(currentCluster,targetCluster,storeDefList2);
  List<RebalanceNodePlan> orderedRebalanceNodePlanList=orderedClusterTransition.getOrderedRebalanceNodePlanList();
  assertEquals("There should have exactly 3 rebalancing node",3,orderedRebalanceNodePlanList.size());
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(0);
    assertEquals("Stealer 0 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(0,3,Arrays.asList(1,3),Arrays.asList(1),Arrays.asList(3),RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(1);
    assertEquals("Stealer 1 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(1,3,Arrays.asList(2),Arrays.asList(2),empty,RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(2);
    assertEquals("Stealer 2 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(2,3,Arrays.asList(3),Arrays.asList(3),empty,RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
  currentCluster=ServerTestUtils.getLocalCluster(4,new int[][]{{3,0,4},{1,5},{2,6},{7}});
  targetCluster=ServerTestUtils.getLocalCluster(4,new int[][]{{3,0,4},{7,1,5},{2,6},{}});
  orderedClusterTransition=createOrderedClusterTransition(currentCluster,targetCluster,storeDefList2);
  orderedRebalanceNodePlanList=orderedClusterTransition.getOrderedRebalanceNodePlanList();
  assertEquals("There should have exactly 3 rebalancing node",3,orderedRebalanceNodePlanList.size());
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(0);
    assertEquals("Stealer 1 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(1,3,Arrays.asList(6,7),Arrays.asList(6),Arrays.asList(7),RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(1);
    assertEquals("Stealer 0 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(0,3,Arrays.asList(5),Arrays.asList(5),empty,RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
{
    RebalanceNodePlan rebalanceNodePlan=orderedRebalanceNodePlanList.get(2);
    assertEquals("Stealer 2 should have 1 entry",1,rebalanceNodePlan.getRebalanceTaskList().size());
    RebalancePartitionsInfo a=new RebalancePartitionsInfo(2,3,Arrays.asList(7),Arrays.asList(7),empty,RebalanceUtils.getStoreNames(storeDefList2),0);
    checkAllRebalanceInfoPresent(rebalanceNodePlan,Arrays.asList(a));
  }
}
