{
  List<Versioned<byte[]>> storesInfo=metadataStore.get(ByteUtils.getBytes(storeKey,"UTF-8"));
  if (storesInfo.size() > 1) {
    throw new UnableUpdateMetadataException("Inconistent Stores Metdata found on Server:" + metadata.getIdentityNode().getId());
  }
  VectorClock updatedVersion=((VectorClock)storesInfo.get(0).getVersion());
  updatedVersion.incrementVersion(metadata.getIdentityNode().getId(),System.currentTimeMillis());
  try {
    String storesString=inputStream.readUTF();
    List<StoreDefinition> storeDefs=new StoreDefinitionsMapper().readStoreList(new StringReader(storesString));
    metadataStore.put(new ByteArray(ByteUtils.getBytes(MetadataStore.STORES_KEY,"UTF-8")),new Versioned<byte[]>(ByteUtils.getBytes(new StoreDefinitionsMapper().writeStoreList(storeDefs),"UTF-8"),updatedVersion));
    metadata.setStoreDefs(storeDefs);
    metadata.setStoreDefMap(storeDefs);
    metadata.reinitRoutingStrategies();
    outputStream.writeShort(0);
    outputStream.flush();
  }
 catch (  VoldemortException e) {
    e.printStackTrace();
    writeException(outputStream,e);
    return;
  }
}
