{
  final long startTime=1445468640;
  final int resetDurationMs=1000;
  final int tinyDurationMs=10;
  Time mockTime=mock(Time.class);
  when(mockTime.getMilliseconds()).thenReturn(startTime);
  RequestCounter rc=new RequestCounter(resetDurationMs,mockTime);
  rc.addRequest(100 * NS_PER_MS,0,1000,100,1);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,2);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,3);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,4);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,5);
  when(mockTime.getMilliseconds()).thenReturn(startTime + tinyDurationMs);
  assertEquals(500d,rc.getThroughput(),0.0f);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,4);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,5);
  when(mockTime.getMilliseconds()).thenReturn(startTime + 700);
  assertEquals(10d,rc.getThroughput(),0.0f);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,4);
  when(mockTime.getMilliseconds()).thenReturn(startTime + resetDurationMs + 1);
  assertEquals(0d,rc.getThroughput(),0.0f);
  rc.addRequest(100 * NS_PER_MS,0,1000,100,1);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,2);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,3);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,4);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,5);
  when(mockTime.getMilliseconds()).thenReturn(startTime + resetDurationMs + 1+ tinyDurationMs);
  assertEquals(500d,rc.getThroughput(),0.0f);
  when(mockTime.getMilliseconds()).thenReturn(startTime + 2 * resetDurationMs + 2);
  assertEquals(0d,rc.getThroughput(),0.0f);
  rc.addRequest(100 * NS_PER_MS,0,1000,100,1);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,2);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,3);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,4);
  rc.addRequest(50 * NS_PER_MS,0,1000,100,5);
  when(mockTime.getMilliseconds()).thenReturn(startTime + 2 * resetDurationMs + 2 + tinyDurationMs);
  assertEquals(500d,rc.getThroughput(),0.0f);
}
