{
  String fetchUrl=getRequired(req,"dir");
  String storeName=getRequired(req,"store");
  String pushVersionString=getOptional(req,"pushVersion");
  ReadOnlyStorageEngine store=this.getStore(storeName);
  long pushVersion;
  if (pushVersionString == null) {
    pushVersion=store.getMaxVersionId() + 1;
  }
 else {
    pushVersion=Long.parseLong(pushVersionString);
    if (pushVersion <= store.getMaxVersionId()) {
      throw new ServletException("Version of push specified (" + pushVersion + ") should be greater than current version "+ store.getMaxVersionId());
    }
  }
  File fetchDir=null;
  if (fileFetcher == null) {
    logger.warn("File fetcher class has not instantiated correctly");
    fetchDir=new File(fetchUrl);
  }
 else {
    logger.info("Executing fetch of " + fetchUrl);
    try {
      fetchDir=fileFetcher.fetch(fetchUrl,store.getStoreDirPath() + File.separator + "version-"+ pushVersion);
      if (fetchDir == null) {
        throw new ServletException("File fetcher failed for " + fetchUrl + " and store name = "+ storeName+ " due to incorrect input path/checksum error");
      }
 else {
        logger.info("Fetch complete.");
      }
    }
 catch (    Exception e) {
      throw new ServletException("Exception in Fetcher = " + e.getMessage());
    }
  }
  resp.getWriter().write(fetchDir.getAbsolutePath());
}
