{
  try {
    if ("swap".equals(getRequired(req,"operation"))) {
      String indexFile=getRequired(req,"index");
      String dataFile=getRequired(req,"data");
      String storeName=getRequired(req,"store");
      RandomAccessFileStore store=this.getStore(storeName);
      if (store == null)       throw new ServletException("'" + storeName + "' is not a registered read-only store.");
      if (!Utils.isReadableFile(indexFile))       throw new ServletException("Index file '" + indexFile + "' is not a readable file.");
      if (!Utils.isReadableFile(dataFile))       throw new ServletException("Data file '" + dataFile + "' is not a readable file.");
      store.swapFiles(indexFile,dataFile);
      resp.getWriter().write("Swap completed.");
    }
 else     if ("fetch".equals(getRequired(req,"operation"))) {
      String indexUrl=getRequired(req,"index");
      String dataUrl=getRequired(req,"data");
      File indexFile;
      File dataFile;
      if (fileFetcher == null) {
        indexFile=new File(indexUrl);
        dataFile=new File(dataUrl);
      }
 else {
        logger.info("Executing fetch of " + indexUrl);
        indexFile=fileFetcher.fetchFile(indexUrl);
        logger.info("Executing fetch of " + dataUrl);
        dataFile=fileFetcher.fetchFile(dataUrl);
        logger.info("Fetch complete.");
      }
      resp.getWriter().write(indexFile.getAbsolutePath());
      resp.getWriter().write("\n");
      resp.getWriter().write(dataFile.getAbsolutePath());
    }
 else {
      throw new IllegalArgumentException("Unknown operation parameter: " + req.getParameter("operation"));
    }
  }
 catch (  Exception e) {
    resp.sendError(500,"Error while performing operation: " + e.getMessage());
  }
}
