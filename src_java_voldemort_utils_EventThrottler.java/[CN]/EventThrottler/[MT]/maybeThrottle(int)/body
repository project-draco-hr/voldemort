{
  eventsSeenInLastInterval+=eventsSeen;
  long now=time.getNanoseconds();
  long ellapsedNs=now - startTime;
  if (ellapsedNs > intervalMs * Time.NS_PER_MS && eventsSeenInLastInterval > 0) {
    long eventsPerSec=(eventsSeenInLastInterval * Time.NS_PER_SECOND) / ellapsedNs;
    if (eventsPerSec > ratesPerSecond) {
      double maxEventsPerMs=ratesPerSecond / (double)Time.MS_PER_SECOND;
      long ellapsedMs=ellapsedNs / Time.NS_PER_MS;
      long sleepTime=Math.round(eventsSeenInLastInterval / maxEventsPerMs - ellapsedMs);
      if (logger.isDebugEnabled())       logger.debug("Natural rate is " + eventsPerSec + " events/sec max allowed rate is "+ ratesPerSecond+ " events/sec, sleeping for "+ sleepTime+ " ms to compensate.");
      if (sleepTime > 0) {
        try {
          time.sleep(sleepTime);
        }
 catch (        InterruptedException e) {
          throw new VoldemortException(e);
        }
      }
    }
    startTime=now;
    eventsSeenInLastInterval=0;
  }
}
