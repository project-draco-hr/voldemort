{
  int left=data.length;
  int inputOffset=0;
  LZFChunk first=null, curr=null;
  int totalBytes=0;
  while (left > 0) {
    int len=Math.min(left,MAX_CHUNK_LEN);
    LZFChunk chunk=compressChunk(data,inputOffset,len);
    inputOffset+=len;
    left-=len;
    if (first == null) {
      first=curr=chunk;
    }
 else {
      curr.setNext(chunk);
      curr=chunk;
    }
    totalBytes+=curr.length();
  }
  byte[] result=new byte[totalBytes];
  int ptr=0;
  for (; first != null; first=first.next()) {
    ptr=first.copyTo(result,ptr);
  }
  return result;
}
