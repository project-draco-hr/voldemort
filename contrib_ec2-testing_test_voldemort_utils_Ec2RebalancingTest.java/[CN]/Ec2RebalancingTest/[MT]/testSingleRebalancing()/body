{
  int clusterSize=ec2RebalancingTestConfig.getInstanceCount();
  int[][] targetLayout=insertNode(partitionMap,partitionMap[clusterSize - 1].length - 2);
  if (logger.isInfoEnabled())   logPartitionMap(targetLayout,"Target");
  Cluster targetCluster=ServerTestUtils.getLocalCluster(clusterSize + 1,getPorts(clusterSize + 1),targetLayout);
  List<Integer> originalNodes=new ArrayList<Integer>();
  for (  Node node : originalCluster.getNodes()) {
    originalNodes.add(node.getId());
  }
  targetCluster=expandCluster(targetCluster.getNumberOfNodes() - clusterSize,targetCluster);
  try {
    RebalanceClient rebalanceClient=new RebalanceClient(getBootstrapUrl(Arrays.asList(originalCluster.getNodeById(0).getHost())),new RebalanceClientConfig());
    populateData(originalCluster,originalNodes);
    rebalanceAndCheck(originalCluster,targetCluster,rebalanceClient,Arrays.asList(clusterSize));
  }
  finally {
    stopCluster(hostNames,ec2RebalancingTestConfig);
  }
}
