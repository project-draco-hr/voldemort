{
  this.storeRepository=storeRepository;
  performanceStats=new StoreStats();
  this.threadPoolExecutor=new ThreadPoolExecutor(config.getNumRestServiceStorageThreads(),config.getNumRestServiceStorageThreads(),0L,TimeUnit.MILLISECONDS,new LinkedBlockingQueue<Runnable>(config.getRestServiceStorageThreadPoolQueueSize()),threadFactory);
  storageExecutionHandler=new StorageExecutionHandler(threadPoolExecutor,performanceStats,localZoneId);
  connectionStats=new NettyConnectionStats();
  connectionStatsHandler=new NettyConnectionStatsHandler(connectionStats);
  maxHttpContentLength=config.getMaxHttpAggregatedContentLength();
  if (config.isJmxEnabled()) {
    JmxUtils.registerMbean(this.storageExecutionHandler,JmxUtils.createObjectName(JmxUtils.getPackageName(this.storageExecutionHandler.getClass()),JmxUtils.getClassName(this.storageExecutionHandler.getClass())));
    JmxUtils.registerMbean(this.connectionStats,JmxUtils.createObjectName(JmxUtils.getPackageName(this.connectionStats.getClass()),JmxUtils.getClassName(this.connectionStats.getClass())));
    JmxUtils.registerMbean(new StoreStatsJmx(this.performanceStats),JmxUtils.createObjectName(JmxUtils.getPackageName(this.performanceStats.getClass()),JmxUtils.getClassName(this.performanceStats.getClass())));
  }
}
