{
  this.currentCluster=currentCluster;
  this.targetCluster=targetCluster;
  this.rebalanceTaskQueue=new ConcurrentLinkedQueue<RebalanceNodePlan>();
  this.storeDefList=Collections.unmodifiableList(storeDefList);
  if (currentCluster.getNumberOfPartitions() != targetCluster.getNumberOfPartitions())   throw new VoldemortException("Total number of partitions should not change !!");
  this.clusterNodeIdToAllPartitions=Collections.unmodifiableMap(createNodeIdToAllPartitions(currentCluster));
  this.targetNodeIdToAllPartitions=Collections.unmodifiableMap(createNodeIdToAllPartitions(targetCluster));
  this.targetNodeIdToAllDeletedPartitions=Collections.unmodifiableMap(createTargetNodeItToAllDeletePartitions());
  this.targetNodeIdToAllDonatedPartitions=Collections.unmodifiableMap(createTargetNodeItToAllDonatedPartitions());
  for (  Node node : targetCluster.getNodes()) {
    List<RebalancePartitionsInfo> rebalanceNodeList=createRebalancePartitionsInfo(currentCluster,targetCluster,RebalanceUtils.getStoreNames(storeDefList),node.getId(),enabledDeletePartition);
    if (rebalanceNodeList.size() > 0) {
      if (currentROStoreVersionsDirs != null && currentROStoreVersionsDirs.size() > 0) {
        for (        RebalancePartitionsInfo partitionsInfo : rebalanceNodeList) {
          partitionsInfo.setStealerNodeROStoreToDir(currentROStoreVersionsDirs.get(partitionsInfo.getStealerId()));
          partitionsInfo.setDonorNodeROStoreToDir(currentROStoreVersionsDirs.get(partitionsInfo.getDonorId()));
        }
      }
      rebalanceTaskQueue.offer(new RebalanceNodePlan(node.getId(),rebalanceNodeList));
    }
  }
}
