{
  HostNamePair offlineHost=hostNamePairs.get(0);
  Integer nodeId=nodeIds.get(offlineHost.getExternalHostName());
  Node node=new Node(nodeId,offlineHost.getInternalHostName(),8081,6666,6667,Collections.<Integer>emptyList());
  StoreClientFactory scf=new SocketStoreClientFactory(new ClientConfig().setBootstrapUrls("tcp://" + offlineHost.getInternalHostName() + ":6666"));
  FailureDetector failureDetector=scf.getFailureDetector();
  Store<String,String> store=scf.getRawStore("test",null);
  test(store);
  Assert.assertEquals(hostNamePairs.size(),failureDetector.getAvailableNodeCount());
  stopClusterNode(offlineHost.getExternalHostName(),ec2RemoteTestConfig);
  test(store);
  Assert.assertEquals(hostNamePairs.size() - 1,failureDetector.getAvailableNodeCount());
  startClusterNode(offlineHost.getExternalHostName(),ec2RemoteTestConfig,nodeId);
  failureDetector.waitForAvailability(node);
  test(store);
  Assert.assertEquals(hostNamePairs.size(),failureDetector.getAvailableNodeCount());
}
