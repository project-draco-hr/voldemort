{
  Multimap<Integer,ByteArray> failedKeys=ArrayListMultimap.create();
  for (  ByteArray key : keysToNodes.keySet()) {
    List<Node> nodes=strategy.routeRequest(key.get());
    for (    Node node : nodes) {
      if (failedNodes.contains(node.getId())) {
        failedKeys.put(node.getId(),key);
        break;
      }
    }
    try {
      Versioned<byte[]> versioned=new Versioned<byte[]>(keyValues.get(key).get());
      store.put(key,versioned,null);
    }
 catch (    Exception e) {
      if (logger.isTraceEnabled())       logger.trace(e,e);
    }
  }
  return failedKeys;
}
