{
  if (!readingChunks) {
    HttpRequest request=this.request=(HttpRequest)e.getMessage();
    QueryStringDecoder queryStringDecoder=new QueryStringDecoder(request.getUri());
    OP_TYPE operation=getOperationType(queryStringDecoder.getPath());
    Map<String,List<String>> params=queryStringDecoder.getParameters();
    if (params == null || !params.containsKey(STORE_NAME)) {
      System.err.println("Store Name missing. Critical error");
      this.responseContent=ChannelBuffers.copiedBuffer("Store Name missing. Critical error".getBytes());
      return;
    }
    if (request.isChunked()) {
      readingChunks=true;
    }
 else {
      ChannelBuffer content=request.getContent();
      if (!content.readable()) {
        System.err.println("Contents not readable");
        this.responseContent=ChannelBuffers.copiedBuffer("Contents not readable".getBytes());
        return;
      }
switch (operation) {
case GET:
        ByteArray getKey=readKey(content);
      this.fatClientWrapper.submitGetRequest(getKey,e);
    break;
case PUT:
  ByteArray putKey=readKey(content);
byte[] putValue=readValue(content);
this.fatClientWrapper.submitPutRequest(putKey,putValue,e);
break;
default :
System.err.println("Illegal operation.");
this.responseContent=ChannelBuffers.copiedBuffer("Illegal operation.".getBytes());
writeResponse(e);
return;
}
}
}
 else {
HttpChunk chunk=(HttpChunk)e.getMessage();
if (chunk.isLast()) {
readingChunks=false;
buf.append("END OF CONTENT\r\n");
HttpChunkTrailer trailer=(HttpChunkTrailer)chunk;
if (!trailer.getHeaderNames().isEmpty()) {
buf.append("\r\n");
for (String name : trailer.getHeaderNames()) {
for (String value : trailer.getHeaders(name)) {
buf.append("TRAILING HEADER: " + name + " = "+ value+ "\r\n");
}
}
buf.append("\r\n");
}
writeResponse(e);
}
 else {
buf.append("CHUNK: " + chunk.getContent().toString(CharsetUtil.UTF_8) + "\r\n");
}
}
}
