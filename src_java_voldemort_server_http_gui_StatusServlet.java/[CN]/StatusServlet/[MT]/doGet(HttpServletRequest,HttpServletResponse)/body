{
  if ("reset".equals(request.getParameter("action"))) {
    String storeName=request.getParameter("store");
    if (storeName != null) {
      Store<ByteArray,byte[]> store=server.getStoreRepository().getLocalStore(storeName);
      if (store != null && store instanceof StatTrackingStore<?,?>) {
        ((StatTrackingStore<?,?>)store).resetStatistics();
      }
    }
  }
  String format=request.getParameter("format");
  if ("json".equals(format)) {
    outputJSON(response);
    return;
  }
  Map<String,Object> params=Maps.newHashMap();
  params.put("status",socketService.getStatusManager());
  params.put("counters",Tracked.values());
  params.put("stores",server.getStoreRepository().getAllLocalStores());
  velocityEngine.render("status.vm",params,response.getOutputStream());
}
