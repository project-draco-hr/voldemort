{
  fileModificationLock.writeLock().lock();
  try {
    if (isOpen)     throw new IllegalStateException("Attempt to open already open store.");
    if (versionDir == null) {
      versionDir=findLatestVersion();
    }
 else {
      setMaxVersion(versionDir);
    }
    Utils.mkdirs(versionDir);
    logger.info("Creating symbolic link for '" + getName() + "' using directory "+ versionDir.getAbsolutePath());
    Utils.symlink(versionDir.getAbsolutePath(),storeDir.getAbsolutePath() + File.separator + "latest");
    this.fileSet=new ChunkedFileSet(versionDir);
    isOpen=true;
  }
  finally {
    fileModificationLock.writeLock().unlock();
  }
}
