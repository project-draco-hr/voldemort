{
  logger.info("Swapping files for store '" + getName() + "' to "+ newStoreDirectory);
  File newDataDir=new File(newStoreDirectory);
  if (!newDataDir.exists())   throw new VoldemortException("File " + newDataDir.getAbsolutePath() + " does not exist.");
  if (!(newDataDir.getParentFile().compareTo(storeDir.getAbsoluteFile()) == 0 && ReadOnlyUtils.checkVersionDirName(newDataDir)))   throw new VoldemortException("Invalid version folder name '" + newDataDir + "'. Either parent directory is incorrect or format(version-n) is incorrect");
  long newVersionId=ReadOnlyUtils.getVersionId(newDataDir);
  if (newVersionId == -1)   throw new VoldemortException("Unable to parse folder name since format(version-n) is incorrect: " + newStoreDirectory);
  File latestVersion=getLatestFile();
  if (latestVersion != null) {
    long latestVersionId=ReadOnlyUtils.getVersionId(latestVersion);
    if (latestVersionId == -1) {
      logger.error("Unable to parse current latest version: " + latestVersion.getAbsolutePath());
    }
 else {
      if (latestVersionId >= newVersionId) {
        logger.info("No swap required since current latest version " + latestVersionId + " is greater than swap version "+ newVersionId);
        deleteBackups();
        return;
      }
    }
  }
  logger.info("Acquiring write lock on '" + getName() + "':");
  fileModificationLock.writeLock().lock();
  boolean success=false;
  try {
    close();
    logger.info("Opening primary files for store '" + getName() + "' at "+ newStoreDirectory);
    open(newDataDir);
    success=true;
  }
  finally {
    try {
      if (!success)       rollback(null);
    }
  finally {
      fileModificationLock.writeLock().unlock();
      if (success)       logger.info("Swap operation completed successfully on store " + getName() + ", releasing lock.");
 else       logger.error("Swap operation failed.");
    }
  }
  deleteBackups();
}
