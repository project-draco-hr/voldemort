{
  logger.info("Swapping files for store '" + getName() + "' from "+ newStoreDirectory);
  File newDataDir=new File(newStoreDirectory);
  if (!newDataDir.exists())   throw new VoldemortException("File " + newDataDir.getAbsolutePath() + " does not exist.");
  logger.info("Acquiring write lock on '" + getName() + "':");
  fileModificationLock.writeLock().lock();
  boolean success=false;
  try {
    close();
    logger.info("Renaming data and index files for '" + getName() + "':");
    shiftBackupsRight();
    logger.info("Setting primary files for store '" + getName() + "' to "+ newStoreDirectory);
    success=newDataDir.renameTo(new File(storeDir,"version-0"));
    if (success) {
      try {
        open();
      }
 catch (      Exception e) {
        logger.error(e);
        success=false;
      }
    }
  }
  finally {
    try {
      if (!success)       rollback();
    }
  finally {
      fileModificationLock.writeLock().unlock();
      logger.info("Swap operation completed on '" + getName() + "', releasing lock.");
    }
  }
  File extraBackup=new File(storeDir,"version-" + (numBackups + 1));
  if (extraBackup.exists()) {
    logger.info("Deleting oldest backup file " + extraBackup);
    Utils.rm(extraBackup);
    logger.info("Delete completed successfully.");
  }
}
