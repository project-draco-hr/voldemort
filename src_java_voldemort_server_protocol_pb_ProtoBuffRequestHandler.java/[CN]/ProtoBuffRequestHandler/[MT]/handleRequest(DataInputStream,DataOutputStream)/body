{
  VoldemortRequest.Builder request=ProtoUtils.readToBuilder(inputStream,VoldemortRequest.newBuilder());
  boolean shouldRoute=request.getShouldRoute();
  String storeName=request.getStore();
  Store<ByteArray,byte[]> store=getStore(storeName,shouldRoute);
  Message response;
  if (store == null) {
    response=unknownStore(storeName,request.getType());
  }
 else {
switch (request.getType()) {
case GET:
      response=handleGet(request.getGet(),store);
    break;
case GET_ALL:
  response=handleGetAll(request.getGetAll(),store);
break;
case PUT:
response=handlePut(request.getPut(),store);
break;
case DELETE:
response=handleDelete(request.getDelete(),store);
break;
case GET_VERSION:
response=handleGetVersion(request.getGet(),store);
break;
case GET_UNCHECKED:
response=handleGetUncheckedMetadata(request.getGet(),store);
default :
throw new VoldemortException("Unknown operation " + request.getType());
}
}
ProtoUtils.writeMessage(outputStream,response);
}
