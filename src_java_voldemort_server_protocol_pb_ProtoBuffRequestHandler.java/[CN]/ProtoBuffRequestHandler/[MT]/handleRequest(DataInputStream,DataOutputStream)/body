{
  VProto.VoldemortRequest request=VProto.VoldemortRequest.parseFrom(ProtoUtils.readWithSize(inputStream));
  boolean shouldRoute=request.getShouldRoute();
  String storeName=request.getStore();
  Store<ByteArray,byte[]> store=getStore(storeName,shouldRoute);
  Message response;
switch (request.getType()) {
case GET:
    response=handleGet(request.getGet(),store);
  break;
case GET_ALL:
response=handleGetAll(request.getGetAll(),store);
break;
case PUT:
response=handlePut(request.getPut(),store);
break;
case DELETE:
response=handleDelete(request.getDelete(),store);
break;
default :
throw new VoldemortException("Unknown operation " + request.getType());
}
ProtoUtils.writeWithSize(outputStream,response);
}
