{
  VAdminProto.FetchPartitionEntriesResponse.Builder responseBuilder=VAdminProto.FetchPartitionEntriesResponse.newBuilder();
  while (!buffer.isEmpty()) {
    VAdminProto.PartitionEntry.Builder partitionEntry=VAdminProto.PartitionEntry.newBuilder();
    Pair<ByteArray,Versioned<byte[]>> queuedEntry=buffer.remove();
    partitionEntry.setKey(ProtoUtils.encodeBytes(queuedEntry.getFirst()));
    partitionEntry.setVersioned(ProtoUtils.encodeVersioned(queuedEntry.getSecond()));
    responseBuilder.addPartitionEntries(partitionEntry);
  }
  responseBuilder.setContinue(!lastMessage);
  Message response=responseBuilder.build();
  writeMessageAndFlush(response,outputStream);
  return response.getSerializedSize();
}
