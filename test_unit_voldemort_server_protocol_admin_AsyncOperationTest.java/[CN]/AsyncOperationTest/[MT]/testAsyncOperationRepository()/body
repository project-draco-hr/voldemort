{
  Map<String,AsyncOperation> operations=new AsyncOperationRepository(2);
  AsyncOperation completeLater=new AsyncOperation(){
    public void run(){
      try {
        Thread.sleep(500);
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
 finally {
        setComplete();
      }
    }
  }
;
  ExecutorService executorService=Executors.newFixedThreadPool(5);
  executorService.submit(completeLater);
  AsyncOperation completeNow=new AsyncOperation(){
    public void run(){
      setComplete();
    }
  }
;
  executorService.submit(completeNow);
  operations.put("foo1",completeLater);
  operations.put("foo3",completeNow);
  operations.put("foo4",completeLater);
  operations.put("foo5",completeLater);
  assertTrue("Handles overflow okay",operations.containsKey("foo4"));
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
  }
  operations.put("foo5",completeLater);
  assertTrue(operations.containsKey("foo5"));
  assertFalse("Actually does LRU heuristics",operations.containsKey("foo3"));
}
