{
  List<HostNamePair> hostNamePairs=getInstances();
  if (hostNamePairs.size() < 3) {
    createInstances(6);
    hostNamePairs=getInstances();
  }
  final Map<String,Integer> nodeIds=generateClusterDescriptor(hostNamePairs,"/home/kirk/voldemortdev/voldemort/config/single_node_cluster/config/cluster.xml");
  final List<String> hostNames=new ArrayList<String>();
  String bootstrapHostName=hostNamePairs.get(0).getInternalHostName();
  for (  HostNamePair hostNamePair : hostNamePairs)   hostNames.add(hostNamePair.getExternalHostName());
  final String hostUserId="root";
  final File sshPrivateKey=new File("/home/kirk/Dropbox/Configuration/AWS/id_rsa-mustardgrain-keypair");
  final String voldemortParentDirectory=".";
  final String voldemortRootDirectory="voldemort";
  final String voldemortHomeDirectory="voldemort/config/single_node_cluster";
  final File sourceDirectory=new File("/home/kirk/voldemortdev/voldemort");
  Map<String,String> remoteTestArguments=new HashMap<String,String>();
  int startKeyIndex=0;
  final int numRequests=100000;
  final int iterations=25;
  for (  String publicHostName : hostNames) {
    remoteTestArguments.put(publicHostName,"-wd --start-key-index " + (startKeyIndex * numRequests) + " --value-size 100 --iterations "+ iterations+ " tcp://"+ bootstrapHostName+ ":6666 test "+ numRequests);
    startKeyIndex++;
  }
  try {
    new SshClusterStopper(hostNames,sshPrivateKey,hostUserId,voldemortRootDirectory).execute();
  }
 catch (  Exception e) {
  }
  new RsyncDeployer(hostNames,sshPrivateKey,sourceDirectory,hostUserId,voldemortParentDirectory).execute();
  new Thread(new Runnable(){
    public void run(){
      try {
        new SshClusterStarter(hostNames,sshPrivateKey,hostUserId,voldemortRootDirectory,voldemortHomeDirectory,nodeIds).execute();
      }
 catch (      RemoteOperationException e) {
        e.printStackTrace();
      }
    }
  }
).start();
  Thread.sleep(5000);
  new SshRemoteTest(hostNames,sshPrivateKey,hostUserId,voldemortRootDirectory,voldemortHomeDirectory,remoteTestArguments).execute();
  new SshClusterStopper(hostNames,sshPrivateKey,hostUserId,voldemortRootDirectory).execute();
}
