{
  int expectedCacheCount=(totalRequests.getAndIncrement() * percentCached) / 100;
  if (expectedCacheCount >= cachedRequests.get()) {
synchronized (visitedKeys) {
      if (!visitedKeys.isEmpty()) {
        cachedRequests.incrementAndGet();
        return visitedKeys.get(new Random().nextInt(visitedKeys.size()));
      }
    }
  }
  T value=delegate.next();
synchronized (visitedKeys) {
    visitedKeys.add(value);
  }
  return value;
}
