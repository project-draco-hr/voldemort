{
  Cluster cluster=new ClusterMapper().readCluster(new StringReader(context.getConfiguration().get("cluster.xml")));
  List<StoreDefinition> storeDefs=new StoreDefinitionsMapper().readStoreList(new StringReader(context.getConfiguration().get("stores.xml")));
  if (storeDefs.size() != 1)   throw new IllegalStateException("Expected to find only a single store, but found multiple!");
  StoreDefinition storeDef=storeDefs.get(0);
  md5er=ByteUtils.getDigest("md5");
  keySerializerDefinition=storeDef.getKeySerializer();
  valueSerializerDefinition=storeDef.getValueSerializer();
  try {
    SerializerFactory factory=new DefaultSerializerFactory();
    keySerializer=(Serializer<Object>)factory.getSerializer(keySerializerDefinition);
    valueSerializer=(Serializer<Object>)factory.getSerializer(valueSerializerDefinition);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  keyCompressor=new CompressionStrategyFactory().get(keySerializerDefinition.getCompression());
  valueCompressor=new CompressionStrategyFactory().get(valueSerializerDefinition.getCompression());
  routingStrategy=new ConsistentRoutingStrategy(cluster.getNodes(),storeDef.getReplicationFactor());
}
