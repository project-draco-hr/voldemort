{
  final long currentTime=getConfig().getTime().getMilliseconds();
  final long thresholdInterval=getConfig().getThresholdInterval();
  final int thresholdCountMinimum=getConfig().getThresholdCountMinimum();
  final int threshold=getConfig().getThreshold();
  NodeStatus nodeStatus=getNodeStatus(node);
synchronized (nodeStatus) {
    if (currentTime >= nodeStatus.getStartMillis() + thresholdInterval) {
      nodeStatus.setStartMillis(currentTime);
      nodeStatus.setSuccess(successDelta);
      nodeStatus.setTotal(totalDelta);
      setAvailable(node);
    }
 else {
      nodeStatus.incrementSuccess(successDelta);
      nodeStatus.incrementTotal(totalDelta);
      if (nodeStatus.getTotal() >= thresholdCountMinimum) {
        long newThreshold=(nodeStatus.getSuccess() * 100) / nodeStatus.getTotal();
        if (newThreshold >= threshold)         setAvailable(node);
 else         setUnavailable(node,e);
      }
    }
    return nodeStatus.isAvailable();
  }
}
