{
  Cluster cluster=this.metadata.getCurrentCluster();
  storeRepository.addStorageEngine(engine);
  Store<ByteArray,byte[]> store=engine;
  if (voldemortConfig.isVerboseLoggingEnabled())   store=new LoggingStore<ByteArray,byte[]>(store,cluster.getName(),SystemTime.INSTANCE);
  if (voldemortConfig.isMetadataCheckingEnabled())   store=new InvalidMetadataCheckingStore(metadata.getIdentityNode().getId(),store,metadata);
  if (voldemortConfig.isRedirectRoutingEnabled())   store=new RedirectingStore(metadata.getIdentityNode().getId(),store,metadata,socketPool);
  if (voldemortConfig.isStatTrackingEnabled()) {
    store=new StatTrackingStore<ByteArray,byte[]>(store);
    if (voldemortConfig.isJmxEnabled()) {
      MBeanServer mbeanServer=ManagementFactory.getPlatformMBeanServer();
      ObjectName name=JmxUtils.createObjectName(JmxUtils.getPackageName(store.getClass()),store.getName());
      if (mbeanServer.isRegistered(name))       JmxUtils.unregisterMbean(mbeanServer,name);
      JmxUtils.registerMbean(mbeanServer,JmxUtils.createModelMBean(store),name);
    }
  }
  storeRepository.addLocalStore(store);
}
