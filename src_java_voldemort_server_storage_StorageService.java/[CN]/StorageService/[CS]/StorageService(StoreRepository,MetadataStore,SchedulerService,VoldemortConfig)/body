{
  super(ServiceType.STORAGE);
  this.voldemortConfig=config;
  this.scheduler=scheduler;
  this.storeRepository=storeRepository;
  this.metadata=metadata;
  this.cleanupPermits=new Semaphore(1);
  this.storageConfigs=new ConcurrentHashMap<String,StorageConfiguration>();
  this.clientThreadPool=new ClientThreadPool(config.getClientMaxThreads(),config.getClientThreadIdleMs(),config.getClientMaxQueuedRequests());
  this.socketPool=new SocketPool(config.getClientMaxConnectionsPerNode(),config.getClientConnectionTimeoutMs(),config.getSocketTimeoutMs(),config.getSocketBufferSize());
  FailureDetectorConfig failureDetectorConfig=new FailureDetectorConfig().setImplementationClassName(voldemortConfig.getFailureDetector()).setJmxEnabled(voldemortConfig.isJmxEnabled()).setNodeBannagePeriod(voldemortConfig.getClientNodeBannageMs()).setNodes(metadata.getCluster().getNodes()).setStoreResolver(new ServerStoreResolver(storeRepository,voldemortConfig.getNodeId()));
  failureDetector=FailureDetectorUtils.create(failureDetectorConfig);
}
