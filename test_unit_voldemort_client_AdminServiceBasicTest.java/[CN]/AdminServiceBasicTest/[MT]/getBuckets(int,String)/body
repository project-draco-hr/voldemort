{
  StoreDefinition def=null;
  for (  StoreDefinition storeDef : storeDefs) {
    if (storeDef.getName().compareTo(storeName) == 0) {
      def=storeDef;
      break;
    }
  }
  if (def == null) {
    throw new VoldemortException("Couldn't find store " + storeName + " in the store definition list");
  }
  List<Integer> nodePartitionIds=cluster.getNodeById(nodeId).getPartitionIds();
  List<Pair<Integer,Integer>> buckets=Lists.newArrayList();
  RoutingStrategy routingStrategy=new RoutingStrategyFactory().updateRoutingStrategy(def,cluster);
  for (  Node node : cluster.getNodes()) {
    for (    int partitionId : node.getPartitionIds()) {
      List<Integer> routingPartitionList=routingStrategy.getReplicatingPartitionList(partitionId);
      for (int replicaType=0; replicaType < routingPartitionList.size(); replicaType++) {
        if (nodePartitionIds.contains(routingPartitionList.get(replicaType))) {
          buckets.add(Pair.create(routingPartitionList.get(0),replicaType));
        }
      }
    }
  }
  return buckets;
}
