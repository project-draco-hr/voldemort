{
  List<Integer> zoneIds=new ArrayList<Integer>(targetCluster.getZoneIds());
  Cluster returnCluster=ClusterUtils.copyCluster(targetCluster);
  double currentMaxMinRatio=analyzeBalance(returnCluster,storeDefs);
  int successes=0;
  for (int i=0; i < randomSwapAttempts; i++) {
    Collections.shuffle(zoneIds,new Random(System.currentTimeMillis()));
    for (    Integer zoneId : zoneIds) {
      Cluster shuffleResults=swapRandomPartitionsWithinZone(returnCluster,zoneId);
      double nextMaxMinRatio=analyzeBalance(shuffleResults,storeDefs);
      if (nextMaxMinRatio < currentMaxMinRatio) {
        System.out.println("Swap improved max-min ratio: " + currentMaxMinRatio + " -> "+ nextMaxMinRatio+ " (improvement "+ successes+ " on swap attempt "+ i+ " in zone "+ zoneId+ ")");
        int xZoneMoves=0;
        if (!enableXzoneShuffle) {
          xZoneMoves=RebalanceUtils.getCrossZoneMoves(shuffleResults,new RebalanceClusterPlan(returnCluster,shuffleResults,storeDefs,true));
        }
        if (xZoneMoves == 0) {
          successes++;
          returnCluster=shuffleResults;
          currentMaxMinRatio=nextMaxMinRatio;
        }
 else {
          System.out.println("BUT, swap resulted in a cross zone move and so is ignored.");
        }
      }
    }
    if (successes >= randomSwapSuccesses) {
      break;
    }
  }
  return returnCluster;
}
