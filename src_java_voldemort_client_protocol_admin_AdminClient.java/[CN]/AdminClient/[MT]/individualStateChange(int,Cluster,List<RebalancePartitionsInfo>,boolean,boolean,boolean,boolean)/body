{
  if (!changeClusterMetadata && rebalancePartitionPlanList == null) {
    return;
  }
  logger.info("Node " + nodeId + "] Performing "+ (rollback ? "rollback" : "normal")+ " rebalance state change "+ (swapRO ? "<swap RO>" : "")+ (changeClusterMetadata ? "<change cluster - " + cluster + ">" : "")+ (changeRebalanceState ? "<change rebalance state - " + rebalancePartitionPlanList + ">" : ""));
  VAdminProto.RebalanceStateChangeRequest.Builder getRebalanceStateChangeRequestBuilder=VAdminProto.RebalanceStateChangeRequest.newBuilder();
  if (rebalancePartitionPlanList != null) {
    List<RebalancePartitionInfoMap> map=Lists.newArrayList();
    for (    RebalancePartitionsInfo stealInfo : rebalancePartitionPlanList) {
      RebalancePartitionInfoMap infoMap=ProtoUtils.encodeRebalancePartitionInfoMap(stealInfo);
      map.add(infoMap);
    }
    getRebalanceStateChangeRequestBuilder.addAllRebalancePartitionInfoList(map);
  }
  VAdminProto.RebalanceStateChangeRequest getRebalanceStateChangeRequest=getRebalanceStateChangeRequestBuilder.setSwapRo(swapRO).setChangeClusterMetadata(changeClusterMetadata).setChangeRebalanceState(changeRebalanceState).setClusterString(clusterMapper.writeCluster(cluster)).setRollback(rollback).build();
  VAdminProto.VoldemortAdminRequest adminRequest=VAdminProto.VoldemortAdminRequest.newBuilder().setRebalanceStateChange(getRebalanceStateChangeRequest).setType(VAdminProto.AdminRequestType.REBALANCE_STATE_CHANGE).build();
  VAdminProto.RebalanceStateChangeResponse.Builder response=sendAndReceive(nodeId,adminRequest,VAdminProto.RebalanceStateChangeResponse.newBuilder());
  if (response.hasError()) {
    throwException(response.getError());
  }
}
