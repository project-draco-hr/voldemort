{
  if (isClosed)   return;
  isClosed=true;
  try {
    for (    SelectionKey sk : selector.keys()) {
      try {
        if (logger.isTraceEnabled())         logger.trace("Closing SelectionKey's channel " + sk + " for "+ endpoint);
        sk.channel().close();
      }
 catch (      Exception e) {
        if (logger.isEnabledFor(Level.WARN))         logger.warn(e.getMessage(),e);
      }
      try {
        if (logger.isTraceEnabled())         logger.trace("Cancelling SelectionKey " + sk + " for "+ endpoint);
        sk.cancel();
      }
 catch (      Exception e) {
        if (logger.isEnabledFor(Level.WARN))         logger.warn(e.getMessage(),e);
      }
    }
  }
 catch (  Exception e) {
    if (logger.isEnabledFor(Level.WARN))     logger.warn(e.getMessage(),e);
  }
  try {
    selector.close();
  }
 catch (  Exception e) {
    if (logger.isEnabledFor(Level.WARN))     logger.warn(e.getMessage(),e);
  }
}
