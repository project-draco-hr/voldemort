{
  if (donorNodePlans.size() == 0) {
    logger.info("Nothing to move around");
    return;
  }
  logger.info("Changing state of donor nodes " + donorNodePlans.keySet());
  int i=0;
  for (  Map.Entry<Integer,RebalanceNodePlan> entry : stealerNodePlans.entrySet()) {
    i+=entry.getValue().getRebalanceTaskList().size();
  }
  final int total=i * storeNames.size();
  final AtomicInteger completed=new AtomicInteger(0);
  try {
    changeToGrandfather();
    final CountDownLatch latch=new CountDownLatch(stealerNodeIds.size());
    for (    final int stealerNodeId : stealerNodeIds) {
      executor.submit(new Runnable(){
        public void run(){
          try {
            RebalanceNodePlan nodePlan=stealerNodePlans.get(stealerNodeId);
            if (nodePlan == null) {
              logger.info("No plan for stealer node id " + stealerNodeId);
              return;
            }
            List<RebalancePartitionsInfo> partitionInfo=nodePlan.getRebalanceTaskList();
            logger.info("Working on stealer node id " + stealerNodeId);
            for (            String storeName : storeNames) {
              logger.info("- Working on store " + storeName);
              HashMap<Integer,Integer> nodeIdToRequestId=Maps.newHashMap();
              for (              RebalancePartitionsInfo r : partitionInfo) {
                logger.info("-- Started migration for donor node id " + r);
                if (!simulation)                 nodeIdToRequestId.put(r.getDonorId(),adminClient.migratePartitions(r.getDonorId(),stealerNodeId,storeName,r.getPartitionList(),null));
              }
              Set<Integer> pending=Sets.newHashSet(nodeIdToRequestId.keySet());
              while (!pending.isEmpty()) {
                for (                int nodeId : nodeIdToRequestId.keySet()) {
                  AsyncOperationStatus status=adminClient.getAsyncRequestStatus(stealerNodeId,nodeIdToRequestId.get(nodeId));
                  logger.info("Status from node " + nodeId + " ("+ status.getDescription()+ ") - "+ status.getStatus());
                  if (status.isComplete()) {
                    if (pending.contains(nodeId)) {
                      logger.info("-- Completed migration from " + nodeId + " to "+ +stealerNodeId);
                      pending.remove(nodeId);
                      logger.info("Finished " + completed.getAndIncrement() + " out of "+ total+ " tasks");
                    }
                    if (pending.isEmpty())                     break;
                  }
                  try {
                    Thread.sleep(30000);
                  }
 catch (                  InterruptedException e) {
                    logger.error(e,e);
                    throw new VoldemortException(e);
                  }
                }
              }
            }
            logger.info("Finished migrating to " + stealerNodeId);
            logger.info("===============================================");
          }
  finally {
            latch.countDown();
          }
        }
      }
);
    }
    try {
      latch.await();
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  finally {
    if (donorStates != null && transitionToNormal) {
      changeToNormal();
    }
    executor.shutdown();
  }
}
