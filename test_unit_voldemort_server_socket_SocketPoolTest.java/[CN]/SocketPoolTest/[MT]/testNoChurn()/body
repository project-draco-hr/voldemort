{
  ExecutorService service=Executors.newFixedThreadPool(10);
  int numRequests=1000;
  final AtomicInteger curr=new AtomicInteger(0);
  final CountDownLatch latch=new CountDownLatch(numRequests);
  for (int i=0; i < numRequests; i++) {
    service.execute(new Runnable(){
      public void run(){
        SocketDestination dest=curr.getAndIncrement() % 2 == 0 ? dest1 : dest2;
        SocketAndStreams sas=pool.checkout(dest);
        pool.checkin(dest1,sas);
        latch.countDown();
      }
    }
);
  }
  latch.await();
  assertEquals(maxConnections,pool.getNumberSocketsCreated());
}
