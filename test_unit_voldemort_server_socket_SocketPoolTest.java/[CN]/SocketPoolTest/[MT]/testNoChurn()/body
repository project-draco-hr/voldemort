{
  ExecutorService service=Executors.newFixedThreadPool(10);
  int numRequests=100;
  final AtomicInteger curr=new AtomicInteger(0);
  final CountDownLatch latch=new CountDownLatch(numRequests);
  for (int i=0; i < numRequests; i++) {
    service.execute(new Runnable(){
      public void run(){
        SocketDestination dest=curr.getAndIncrement() % 2 == 0 ? dest1 : dest2;
        SocketAndStreams sas=pool.checkout(dest);
        pool.checkin(dest,sas);
        latch.countDown();
      }
    }
);
  }
  latch.await();
  assertTrue("Created more sockets than expected (created = " + pool.getNumberSocketsCreated() + ", expected = "+ maxTotalConnections+ ".",maxTotalConnections >= pool.getNumberSocketsCreated());
}
