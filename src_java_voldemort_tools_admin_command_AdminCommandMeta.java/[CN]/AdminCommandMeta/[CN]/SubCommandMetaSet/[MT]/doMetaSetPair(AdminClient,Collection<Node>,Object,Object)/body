{
  List<Integer> nodeIds=Lists.newArrayList();
  VectorClock updatedClusterVersion=null;
  VectorClock updatedStoresVersion=null;
  for (  Node node : nodes) {
    nodeIds.add(node.getId());
    if (updatedClusterVersion == null && updatedStoresVersion == null) {
      updatedClusterVersion=(VectorClock)adminClient.metadataMgmtOps.getRemoteMetadata(node.getId(),MetadataStore.CLUSTER_KEY).getVersion();
      updatedStoresVersion=(VectorClock)adminClient.metadataMgmtOps.getRemoteMetadata(node.getId(),MetadataStore.STORES_KEY).getVersion();
    }
 else {
      updatedClusterVersion=updatedClusterVersion.merge((VectorClock)adminClient.metadataMgmtOps.getRemoteMetadata(node.getId(),MetadataStore.CLUSTER_KEY).getVersion());
      updatedStoresVersion=updatedStoresVersion.merge((VectorClock)adminClient.metadataMgmtOps.getRemoteMetadata(node.getId(),MetadataStore.STORES_KEY).getVersion());
    }
    updatedClusterVersion=updatedClusterVersion.incremented(nodeIds.get(0),System.currentTimeMillis());
    updatedStoresVersion=updatedStoresVersion.incremented(nodeIds.get(0),System.currentTimeMillis());
  }
  adminClient.metadataMgmtOps.updateRemoteMetadataPair(nodeIds,MetadataStore.CLUSTER_KEY,Versioned.value(clusterValue.toString(),updatedClusterVersion),MetadataStore.STORES_KEY,Versioned.value(storesValue.toString(),updatedStoresVersion));
}
