{
  try {
    environmentConfig=new EnvironmentConfig();
    environmentConfig.setTransactional(true);
    environmentConfig.setCacheSize(config.getBdbCacheSize());
    if (config.isBdbWriteTransactionsEnabled() && config.isBdbFlushTransactionsEnabled()) {
      environmentConfig.setTxnNoSync(false);
      environmentConfig.setTxnWriteNoSync(false);
    }
 else     if (config.isBdbWriteTransactionsEnabled() && !config.isBdbFlushTransactionsEnabled()) {
      environmentConfig.setTxnNoSync(false);
      environmentConfig.setTxnWriteNoSync(true);
    }
 else {
      environmentConfig.setTxnNoSync(true);
    }
    environmentConfig.setAllowCreate(true);
    environmentConfig.setConfigParam(EnvironmentConfig.LOG_FILE_MAX,Long.toString(config.getBdbMaxLogFileSize()));
    environmentConfig.setConfigParam(EnvironmentConfig.CHECKPOINTER_BYTES_INTERVAL,Long.toString(config.getBdbCheckpointBytes()));
    environmentConfig.setConfigParam(EnvironmentConfig.CHECKPOINTER_WAKEUP_INTERVAL,Long.toString(config.getBdbCheckpointMs() * Time.US_PER_MS));
    databaseConfig=new DatabaseConfig();
    databaseConfig.setAllowCreate(true);
    databaseConfig.setNodeMaxEntries(config.getBdbBtreeFanout());
    databaseConfig.setTransactional(true);
    File bdbDir=new File(config.getBdbDataDirectory());
    if (!bdbDir.exists())     bdbDir.mkdir();
    environment=new Environment(bdbDir,environmentConfig);
    isInitialized=true;
  }
 catch (  DatabaseException e) {
    throw new StorageInitializationException(e);
  }
}
