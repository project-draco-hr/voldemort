{
  for (int i=0; i < 3; i++) {
    Pair oldv=values.get();
    long startTime=oldv.startTime;
    long count=oldv.count + 1;
    long now=System.currentTimeMillis();
    double averageTime=oldv.averageTime;
    averageTime+=(time - averageTime) / count;
    if (now - startTime > duration) {
      startTime=now;
      count=1;
      averageTime=time;
    }
    Pair newv=new Pair(startTime,count,averageTime);
    if (values.compareAndSet(oldv,newv))     return;
  }
}
