{
  writeLock.lock();
  try {
    if (METADATA_KEYS.contains(key)) {
      if (STORES_KEY.equals(key)) {
        List<StoreDefinition> storeDefs=(List<StoreDefinition>)value.getValue();
        String AVRO_GENERIC_VERSIONED_TYPE_NAME="avro-generic-versioned";
        for (        StoreDefinition storeDef : storeDefs) {
          SerializerDefinition keySerDef=storeDef.getKeySerializer();
          SerializerDefinition valueSerDef=storeDef.getValueSerializer();
          if (keySerDef.getName().equals(AVRO_GENERIC_VERSIONED_TYPE_NAME)) {
            SchemaEvolutionValidator.checkSchemaCompatibility(keySerDef);
          }
          if (valueSerDef.getName().equals(AVRO_GENERIC_VERSIONED_TYPE_NAME)) {
            SchemaEvolutionValidator.checkSchemaCompatibility(valueSerDef);
          }
        }
      }
      putInner(key,convertObjectToString(key,value));
      metadataCache.put(key,value);
      if (CLUSTER_KEY.equals(key)) {
        updateRoutingStrategies((Cluster)value.getValue(),getStoreDefList());
      }
 else       if (STORES_KEY.equals(key)) {
        updateRoutingStrategies(getCluster(),(List<StoreDefinition>)value.getValue());
      }
 else       if (SYSTEM_STORES_KEY.equals(key))       throw new VoldemortException("Cannot overwrite system store definitions");
    }
 else {
      throw new VoldemortException("Unhandled Key:" + key + " for MetadataStore put()");
    }
  }
  finally {
    writeLock.unlock();
  }
}
