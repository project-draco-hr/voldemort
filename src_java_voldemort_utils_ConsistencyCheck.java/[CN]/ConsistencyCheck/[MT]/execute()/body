{
  Map<ClusterNode,Iterator<Pair<ByteArray,Versioned<byte[]>>>> nodeFetchIteratorMap;
  nodeFetchIteratorMap=new HashMap<ClusterNode,Iterator<Pair<ByteArray,Versioned<byte[]>>>>();
  for (  ClusterNode clusterNode : clusterNodeList) {
    AdminClient adminClient=adminClients.get(clusterNode.getPrefixId());
    List<Integer> singlePartition=new ArrayList<Integer>();
    singlePartition.add(partitionId);
    if (logger.isDebugEnabled()) {
      logger.debug("Start fetch request to Node[" + clusterNode.toString() + "] for partition["+ partitionId+ "] of store["+ storeName+ "]");
    }
    Iterator<Pair<ByteArray,Versioned<byte[]>>> fetchIterator;
    fetchIterator=adminClient.bulkFetchOps.fetchEntries(clusterNode.getNode().getId(),storeName,singlePartition,null,false);
    nodeFetchIteratorMap.put(clusterNode,fetchIterator);
  }
  keyFetchTracker=new KeyFetchTracker(clusterNodeList.size());
  boolean fetchFinished;
  do {
    fetchFinished=true;
    for (    Map.Entry<ClusterNode,Iterator<Pair<ByteArray,Versioned<byte[]>>>> nodeFetchIteratorMapEntry : nodeFetchIteratorMap.entrySet()) {
      ClusterNode clusterNode=nodeFetchIteratorMapEntry.getKey();
      Iterator<Pair<ByteArray,Versioned<byte[]>>> fetchIterator=nodeFetchIteratorMapEntry.getValue();
      if (fetchIterator.hasNext()) {
        fetchFinished=false;
        reporter.recordScans(1);
        Pair<ByteArray,Versioned<byte[]>> fetchedEntry=fetchIterator.next();
        ByteArray key=fetchedEntry.getFirst();
        Versioned<byte[]> versioned=fetchedEntry.getSecond();
        recordFetch(clusterNode,key,versioned);
        keyFetchTracker.recordFetch(clusterNode,key);
        System.out.println("fetched " + new String(key.get()));
        System.out.println("map has keys: " + keyVersionNodeSetMap.size());
        trySweepAll();
        System.out.println("sweeped; keys left: " + keyVersionNodeSetMap.size());
      }
    }
    if (logger.isInfoEnabled() && !quiet) {
      String report=reporter.tryReport();
      if (report != null) {
        for (        String line : report.split("\n")) {
          logger.info(line);
        }
      }
    }
  }
 while (!fetchFinished);
  for (  AdminClient adminClient : adminClients) {
    if (adminClient != null) {
      adminClient.stop();
    }
  }
  cleanIneligibleKeys(keyVersionNodeSetMap,requiredWrites);
  keyFetchTracker.finishAll();
  trySweepAll();
  if (!quiet) {
    logger.warn("TYPE,Store,ParId,Key,ServerSet,VersionTS,VectorClock[,ValueHash]");
    for (    Map.Entry<ByteArray,Map<Version,Set<ClusterNode>>> entry : keyVersionNodeSetMap.entrySet()) {
      ByteArray key=entry.getKey();
      Map<Version,Set<ClusterNode>> versionMap=entry.getValue();
      logger.warn(keyVersionToString(key,versionMap,storeName,partitionId));
    }
  }
  reporter.recordInconsistentKey(keyVersionNodeSetMap.size());
  return reporter;
}
