{
  OptionSet options=getParser().parse(args);
  boolean verbose=false;
  if (options.hasArgument("help")) {
    printUsage();
    return;
  }
  if (!options.hasArgument("urls") || !options.hasArgument("partitions") || !options.hasArgument("store")) {
    printUsage();
    return;
  }
  if (options.has("verbose")) {
    verbose=true;
  }
  List<String> urls=(List<String>)options.valuesOf("urls");
  String storeName=(String)options.valueOf("store");
  List<Integer> partitionIds=(List<Integer>)options.valuesOf("partitions");
  ConsistencyCheckStats globalStats=new ConsistencyCheckStats();
  Map<Integer,ConsistencyCheckStats> partitionStatsMap=new HashMap<Integer,ConsistencyCheckStats>();
  for (  Integer partitionId : partitionIds) {
    ConsistencyCheck checker=new ConsistencyCheck(urls,storeName,partitionId,verbose);
    checker.connect();
    ConsistencyCheckStats partitionStats=checker.execute();
    partitionStatsMap.put(partitionId,partitionStats);
    globalStats.append(partitionStats);
  }
  StringBuilder statsString=new StringBuilder();
  statsString.append("TYPE,Store,ParitionId,KeysConsistent,KeysTotal,Consistency\n");
  for (  Map.Entry<Integer,ConsistencyCheckStats> entry : partitionStatsMap.entrySet()) {
    Integer partitionId=entry.getKey();
    ConsistencyCheckStats partitionStats=entry.getValue();
    statsString.append("STATS,");
    statsString.append(storeName + ",");
    statsString.append(partitionId + ",");
    statsString.append(partitionStats.consistentKeys + ",");
    statsString.append(partitionStats.totalKeys + ",");
    statsString.append((double)(partitionStats.consistentKeys) / (double)partitionStats.totalKeys);
    statsString.append("\n");
  }
  statsString.append("STATS,");
  statsString.append(storeName + ",");
  statsString.append("aggregate,");
  statsString.append(globalStats.consistentKeys + ",");
  statsString.append(globalStats.totalKeys + ",");
  statsString.append((double)(globalStats.consistentKeys) / (double)globalStats.totalKeys);
  statsString.append("\n");
  System.out.println();
  System.out.println(statsString.toString());
}
