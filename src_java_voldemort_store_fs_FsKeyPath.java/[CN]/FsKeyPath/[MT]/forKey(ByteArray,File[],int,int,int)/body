{
  byte[] digest=ByteUtils.sha1(key.get());
  int id=Math.abs(ByteUtils.readInt(digest,0));
  String baseDir=baseDirs[id % baseDirs.length].getAbsolutePath();
  StringBuilder path=new StringBuilder(baseDir);
  path.append(SLASH);
  for (int i=0; i < depth; i++) {
    String dirId=Integer.toString(Math.abs(ByteUtils.readInt(digest,4 * i)) % fanOut);
    int padding=dirNameLength - dirId.length();
    for (int j=0; j < padding; j++)     path.append('0');
    path.append(dirId);
    path.append(SLASH);
  }
  for (int i=0; i < digest.length; i++)   path.append(HEX_DIGITS[Math.abs(digest[i] % HEX_DIGITS.length)]);
  return new FsKeyPath(key,digest,path.toString(),id);
}
