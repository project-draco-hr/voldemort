{
  StoreUtils.assertValidKeys(keys);
  Map<ByteArray,List<Versioned<byte[]>>> result=StoreUtils.newEmptyHashMap(keys);
  Cursor cursor=null;
  try {
    cursor=getBdbDatabase().openCursor(null,null);
    for (    ByteArray key : keys) {
      List<Versioned<byte[]>> values=get(cursor,key,LockMode.READ_UNCOMMITTED,versionedSerializer);
      if (!values.isEmpty())       result.put(key,values);
    }
  }
 catch (  DatabaseException e) {
    logger.error(e);
    throw new PersistenceFailureException(e);
  }
 finally {
    attemptClose(cursor);
  }
  return result;
}
